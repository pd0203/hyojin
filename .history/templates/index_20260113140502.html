<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Ìö®ÏßÑÏú†ÌÜµ</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          sans-serif;
        background-color: #0a0a0a;
        color: #e0e0e0;
        min-height: 100vh;
        display: flex;
      }

      /* ÏÇ¨Ïù¥ÎìúÎ∞î */
      .sidebar {
        width: 200px;
        background-color: #111;
        padding: 20px 0;
        border-right: 1px solid #222;
        position: fixed;
        height: 100vh;
      }

      .logo {
        color: #00ff88;
        font-size: 20px;
        font-weight: bold;
        padding: 0 20px 30px;
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .nav-item {
        padding: 12px 20px;
        cursor: pointer;
        transition: all 0.2s;
        border-left: 3px solid transparent;
        color: #888;
        font-size: 14px;
      }

      .nav-item:hover {
        background-color: #1a1a1a;
        color: #fff;
      }

      .nav-item.active {
        background-color: #1a1a1a;
        border-left-color: #00ff88;
        color: #00ff88;
      }

      .nav-item.disabled {
        color: #444;
        cursor: not-allowed;
      }

      /* Î©îÏù∏ ÏΩòÌÖêÏ∏† */
      .main-content {
        margin-left: 200px;
        flex: 1;
        padding: 30px 40px;
      }

      .page-title {
        color: #00ff88;
        font-size: 28px;
        margin-bottom: 8px;
      }

      .page-description {
        color: #666;
        margin-bottom: 20px;
      }

      .settings-info {
        background-color: #1a1a1a;
        padding: 12px 20px;
        border-radius: 6px;
        margin-bottom: 25px;
        font-size: 14px;
      }

      .settings-info span {
        color: #00ff88;
      }

      /* ÌÉ≠ */
      .tabs {
        display: flex;
        gap: 5px;
        margin-bottom: 20px;
        border-bottom: 1px solid #333;
        padding-bottom: 0;
      }

      .tab {
        padding: 12px 20px;
        cursor: pointer;
        color: #888;
        font-size: 14px;
        border-bottom: 2px solid transparent;
        transition: all 0.2s;
        display: flex;
        align-items: center;
        gap: 6px;
      }

      .tab:hover {
        color: #fff;
      }

      .tab.active {
        color: #00ff88;
        border-bottom-color: #00ff88;
      }

      .tab-content {
        display: none;
      }

      .tab-content.active {
        display: block;
      }

      /* ÏóÖÎ°úÎìú ÏòÅÏó≠ */
      .upload-area {
        border: 2px dashed #00ff88;
        border-radius: 12px;
        padding: 50px;
        text-align: center;
        background-color: rgba(0, 255, 136, 0.03);
        margin-bottom: 30px;
        transition: all 0.3s;
        cursor: pointer;
      }

      .upload-area:hover {
        background-color: rgba(0, 255, 136, 0.08);
        cursor: pointer;
      }

      .upload-area.dragover {
        background-color: rgba(0, 255, 136, 0.15);
        border-color: #00ff88;
      }

      .upload-icon {
        font-size: 48px;
        margin-bottom: 15px;
      }

      .upload-text {
        font-size: 16px;
        margin-bottom: 8px;
      }

      .upload-hint {
        color: #666;
        font-size: 13px;
      }

      .file-info {
        background-color: rgba(0, 255, 136, 0.1);
        border-radius: 8px;
        padding: 15px 20px;
        margin-top: 20px;
        display: none;
      }

      .file-info.show {
        display: flex;
        align-items: center;
        gap: 12px;
      }

      .file-name {
        color: #00ff88;
        font-weight: 500;
      }

      .file-size {
        color: #888;
        font-size: 13px;
      }

      /* Î≤ÑÌäº */
      .button-group {
        display: flex;
        gap: 15px;
        justify-content: center;
      }

      .btn {
        padding: 14px 30px;
        border-radius: 8px;
        font-size: 15px;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.2s;
        border: none;
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .btn-primary {
        background-color: #00ff88;
        color: #000;
      }

      .btn-primary:hover {
        background-color: #00cc6a;
        transform: translateY(-1px);
      }

      .btn-primary:disabled {
        background-color: #333;
        color: #666;
        cursor: not-allowed;
        transform: none;
      }

      .btn-secondary {
        background-color: #8b7500;
        color: #fff;
      }

      .btn-secondary:hover {
        background-color: #a08600;
      }

      .btn-secondary:disabled {
        background-color: #333;
        color: #666;
        cursor: not-allowed;
      }

      .btn-outline {
        background-color: transparent;
        border: 1px solid #444;
        color: #888;
      }

      .btn-outline:hover {
        border-color: #00ff88;
        color: #00ff88;
      }

      /* Ïä§ÌÉÄÎ∞∞ÏÜ° ÌïÑÌÑ∞ÎßÅ Ï≤¥ÌÅ¨Î∞ïÏä§ */
      .star-filter-checkbox {
        display: flex;
        align-items: center;
        gap: 8px;
        cursor: pointer;
        padding: 10px 16px;
        background-color: #1a1a1a;
        border: 1px solid #333;
        border-radius: 8px;
        transition: all 0.2s;
        user-select: none;
      }

      .star-filter-checkbox:hover {
        border-color: #ffd700;
        background-color: #222;
      }

      .star-filter-checkbox input[type="checkbox"] {
        display: none;
      }

      .star-filter-checkbox .checkmark {
        width: 18px;
        height: 18px;
        border: 2px solid #555;
        border-radius: 4px;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.2s;
      }

      .star-filter-checkbox input:checked + .checkmark {
        background-color: #ffd700;
        border-color: #ffd700;
      }

      .star-filter-checkbox input:checked + .checkmark::after {
        content: "‚úì";
        color: #000;
        font-size: 12px;
        font-weight: bold;
      }

      .star-filter-checkbox .checkbox-label {
        color: #888;
        font-size: 14px;
        transition: color 0.2s;
      }

      .star-filter-checkbox:hover .checkbox-label,
      .star-filter-checkbox input:checked ~ .checkbox-label {
        color: #ffd700;
      }

      /* Î°úÎî© Ïä§ÌîºÎÑà */
      .loading-overlay {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: rgba(0, 0, 0, 0.85);
        z-index: 1000;
        justify-content: center;
        align-items: center;
        flex-direction: column;
      }

      .loading-overlay.show {
        display: flex;
      }

      .spinner {
        width: 80px;
        height: 80px;
        border: 4px solid #222;
        border-top: 4px solid #00ff88;
        border-radius: 50%;
        animation: spin 1s linear infinite;
        margin-bottom: 20px;
      }

      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }

      .loading-text {
        color: #00ff88;
        font-size: 18px;
        margin-bottom: 8px;
      }

      .loading-subtext {
        color: #666;
        font-size: 14px;
      }

      /* Í≤∞Í≥º Î™®Îã¨ */
      .modal-overlay {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: rgba(0, 0, 0, 0.85);
        z-index: 1000;
        justify-content: center;
        align-items: center;
      }

      .modal-overlay.show {
        display: flex;
      }

      .modal {
        background-color: #1a1a1a;
        border-radius: 16px;
        padding: 30px;
        min-width: 450px;
        max-width: 550px;
        border: 1px solid #333;
      }

      .modal-header {
        text-align: center;
        margin-bottom: 25px;
      }

      .modal-icon {
        font-size: 60px;
        margin-bottom: 15px;
      }

      .modal-title {
        font-size: 24px;
        color: #00ff88;
        margin-bottom: 5px;
      }

      .modal-subtitle {
        color: #888;
        font-size: 14px;
      }

      .stats-grid {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 15px;
        margin-bottom: 25px;
      }

      .stat-card {
        background-color: #222;
        border-radius: 10px;
        padding: 20px;
        text-align: center;
      }

      .stat-value {
        font-size: 32px;
        font-weight: bold;
        color: #00ff88;
      }

      .stat-value.warning {
        color: #ff6b6b;
      }

      .stat-label {
        color: #888;
        font-size: 13px;
        margin-top: 5px;
      }

      .accuracy-bar {
        background-color: #222;
        border-radius: 8px;
        padding: 15px 20px;
        margin-bottom: 25px;
      }

      .accuracy-header {
        display: flex;
        justify-content: space-between;
        margin-bottom: 10px;
      }

      .accuracy-label {
        color: #888;
        font-size: 14px;
      }

      .accuracy-value {
        color: #00ff88;
        font-weight: bold;
        font-size: 18px;
      }

      .progress-bar {
        height: 10px;
        background-color: #333;
        border-radius: 5px;
        overflow: hidden;
      }

      .progress-fill {
        height: 100%;
        background: linear-gradient(90deg, #00ff88, #00cc6a);
        border-radius: 5px;
        transition: width 0.5s ease;
      }

      .modal-actions {
        display: flex;
        gap: 12px;
        justify-content: center;
      }

      /* Í≤∞Í≥º Î∂ÑÏÑù ÌÉ≠ */
      .analysis-container {
        background-color: #1a1a1a;
        border-radius: 12px;
        padding: 25px;
      }

      .analysis-header {
        margin-bottom: 20px;
      }

      .analysis-title {
        font-size: 18px;
        color: #00ff88;
        margin-bottom: 5px;
      }

      .analysis-desc {
        color: #666;
        font-size: 14px;
      }

      .no-data {
        text-align: center;
        padding: 60px;
        color: #666;
      }

      .no-data-icon {
        font-size: 48px;
        margin-bottom: 15px;
      }

      .worker-stats {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
        gap: 15px;
      }

      .worker-card {
        background-color: #222;
        border-radius: 10px;
        padding: 20px;
        transition: all 0.2s;
      }

      .worker-card:hover {
        background-color: #2a2a2a;
        transform: translateY(-2px);
      }

      .worker-header {
        display: flex;
        align-items: center;
        gap: 10px;
        margin-bottom: 12px;
      }

      .worker-icon {
        font-size: 24px;
      }

      .worker-name {
        font-size: 16px;
        font-weight: 500;
      }

      .worker-count {
        font-size: 28px;
        font-weight: bold;
        color: #00ff88;
      }

      .worker-stat-row {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 8px 0;
        border-bottom: 1px solid #333;
      }

      .worker-stat-row:last-child {
        border-bottom: none;
      }

      .worker-label {
        color: #888;
        font-size: 14px;
      }

      .worker-value {
        color: #00ff88;
        font-size: 16px;
        font-weight: bold;
      }

      .worker-range {
        color: #00ff88;
        font-size: 14px;
        font-family: "SF Mono", "Monaco", "Consolas", monospace;
      }

      /* Îã¥ÎãπÏûê Í¥ÄÎ¶¨ ÌÉ≠ */
      .workers-list {
        background-color: #1a1a1a;
        border-radius: 12px;
        padding: 20px;
      }

      .worker-item {
        display: flex;
        align-items: center;
        padding: 15px;
        border-bottom: 1px solid #333;
      }

      .worker-item:last-child {
        border-bottom: none;
      }

      .worker-item-icon {
        font-size: 24px;
        margin-right: 15px;
      }

      .worker-item-info {
        flex: 1;
      }

      .worker-item-name {
        font-weight: 500;
        margin-bottom: 3px;
      }

      .worker-item-desc {
        color: #666;
        font-size: 13px;
      }

      .worker-item-count {
        background-color: #222;
        padding: 5px 12px;
        border-radius: 20px;
        font-size: 13px;
        color: #00ff88;
      }

      /* ÏïåÎ¶º ÌÜ†Ïä§Ìä∏ */
      .toast {
        position: fixed;
        bottom: 30px;
        right: 30px;
        background-color: #222;
        border: 1px solid #333;
        border-radius: 10px;
        padding: 15px 25px;
        display: none;
        align-items: center;
        gap: 12px;
        z-index: 1001;
        animation: slideIn 0.3s ease;
      }

      .toast.show {
        display: flex;
      }

      .toast.success {
        border-color: #00ff88;
      }

      .toast.error {
        border-color: #ff6b6b;
      }

      @keyframes slideIn {
        from {
          transform: translateX(100%);
          opacity: 0;
        }
        to {
          transform: translateX(0);
          opacity: 1;
        }
      }

      /* ==================== ÏõêÍ∞Ä ÎßàÏßÑÌëú Ïä§ÌÉÄÏùº ==================== */
      .margin-container {
        max-width: 100%;
      }

      .margin-header {
        margin-bottom: 20px;
      }

      .search-container {
        background-color: #1a1a1a;
        border-radius: 12px;
        padding: 20px;
        margin-bottom: 20px;
      }

      .search-box {
        display: flex;
        align-items: center;
        background-color: #222;
        border: 1px solid #333;
        border-radius: 8px;
        padding: 12px 16px;
        gap: 10px;
        transition: all 0.2s;
      }

      .search-box:focus-within {
        border-color: #00ff88;
      }

      .search-icon {
        font-size: 18px;
      }

      .search-input {
        flex: 1;
        background: none;
        border: none;
        color: #e0e0e0;
        font-size: 16px;
        outline: none;
      }

      .search-input::placeholder {
        color: #666;
      }

      .search-clear {
        background: none;
        border: none;
        color: #666;
        cursor: pointer;
        font-size: 16px;
        padding: 4px;
      }

      .search-clear:hover {
        color: #fff;
      }

      .search-result-count {
        margin-top: 12px;
        color: #888;
        font-size: 14px;
      }

      .table-container {
        background-color: #1a1a1a;
        border-radius: 12px;
        overflow: hidden;
      }

      .loading-data {
        text-align: center;
        padding: 60px;
        color: #666;
      }

      .margin-table {
        width: 100%;
        border-collapse: collapse;
        font-size: 14px;
      }

      .margin-table thead {
        background-color: #222;
        position: sticky;
        top: 0;
        z-index: 10;
      }

      .margin-table th {
        padding: 14px 12px;
        text-align: left;
        color: #00ff88;
        font-weight: 500;
        border-bottom: 2px solid #333;
        white-space: nowrap;
      }

      .margin-table td {
        padding: 12px;
        border-bottom: 1px solid #2a2a2a;
        color: #e0e0e0;
      }

      .margin-table tbody tr:hover {
        background-color: #222;
      }

      .margin-table .col-name {
        min-width: 200px;
        max-width: 300px;
      }

      .margin-table .col-num {
        text-align: right;
        white-space: nowrap;
      }

      .margin-table .col-center {
        text-align: center;
      }

      .margin-table .highlight {
        color: #00ff88;
        font-weight: 500;
      }

      .margin-table .stock-yes {
        color: #00ff88;
      }

      .margin-table .stock-no {
        color: #ff6b6b;
      }

      .no-results {
        text-align: center;
        padding: 60px;
        color: #666;
      }

      .no-results-icon {
        font-size: 48px;
        margin-bottom: 15px;
      }

      /* Ïπ¥Îìú Î∑∞ (Î™®Î∞îÏùºÏö©) */
      .margin-cards {
        display: none;
      }

      .margin-card {
        background-color: #222;
        border-radius: 10px;
        padding: 16px;
        margin-bottom: 12px;
      }

      .margin-card-header {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        margin-bottom: 12px;
        gap: 10px;
      }

      .margin-card-name {
        font-size: 15px;
        font-weight: 500;
        color: #fff;
        flex: 1;
        word-break: keep-all;
      }

      .margin-card-stock {
        font-size: 12px;
        padding: 4px 8px;
        border-radius: 4px;
        white-space: nowrap;
      }

      .margin-card-stock.yes {
        background-color: rgba(0, 255, 136, 0.15);
        color: #00ff88;
      }

      .margin-card-stock.no {
        background-color: rgba(255, 107, 107, 0.15);
        color: #ff6b6b;
      }

      .margin-card-grid {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 10px;
      }

      .margin-card-item {
        display: flex;
        flex-direction: column;
        gap: 2px;
      }

      .margin-card-label {
        font-size: 11px;
        color: #666;
      }

      .margin-card-value {
        font-size: 14px;
        color: #e0e0e0;
      }

      .margin-card-value.highlight {
        color: #00ff88;
        font-weight: 600;
      }

      .margin-card-divider {
        border-top: 1px solid #333;
        margin: 12px 0;
      }

      .margin-card-note {
        font-size: 12px;
        color: #888;
        margin-top: 8px;
      }

      /* Î∞òÏùëÌòï - ÌÉúÎ∏îÎ¶ø */
      @media (max-width: 1024px) {
        .margin-table .col-name {
          min-width: 150px;
        }

        .margin-table th,
        .margin-table td {
          padding: 10px 8px;
          font-size: 13px;
        }
      }

      /* Î∞òÏùëÌòï - Î™®Î∞îÏùº */
      @media (max-width: 768px) {
        .sidebar {
          display: none;
        }

        .main-content {
          margin-left: 0;
          padding: 15px;
        }

        .page-title {
          font-size: 22px;
        }

        .search-container {
          padding: 15px;
        }

        .search-box {
          padding: 10px 14px;
        }

        .search-input {
          font-size: 16px; /* iOS Ï§å Î∞©ÏßÄ */
        }

        /* Î™®Î∞îÏùºÏóêÏÑú Ïπ¥Îìú Î∑∞ ÌëúÏãú */
        .table-wrapper {
          display: none;
        }

        .margin-cards {
          display: block;
          padding: 15px;
        }

        .margin-card-grid {
          grid-template-columns: repeat(2, 1fr);
        }

        /* Î™®Î∞îÏùº ÎÑ§ÎπÑÍ≤åÏù¥ÏÖò */
        .mobile-nav {
          display: flex;
          position: fixed;
          bottom: 0;
          left: 0;
          right: 0;
          background-color: #111;
          border-top: 1px solid #222;
          z-index: 100;
          padding: 8px 0;
          overflow-x: auto;
          -webkit-overflow-scrolling: touch;
        }

        .mobile-nav-item {
          flex: 0 0 auto;
          min-width: 60px;
          display: flex;
          flex-direction: column;
          align-items: center;
          padding: 8px 12px;
          color: #666;
          text-decoration: none;
          font-size: 10px;
          gap: 4px;
        }

        .mobile-nav-item.active {
          color: #00ff88;
        }

        .mobile-nav-icon {
          font-size: 18px;
        }

        body {
          padding-bottom: 70px;
        }
      }

      /* ÌÖåÏù¥Î∏î ÎûòÌçº */
      .table-wrapper {
        overflow-x: auto;
        max-height: 70vh;
      }

      /* Ïú†Ï†Ä ÌîÑÎ°úÌïÑ */
      .user-profile {
        position: fixed;
        top: 20px;
        right: 30px;
        z-index: 100;
      }

      .user-btn {
        display: flex;
        align-items: center;
        gap: 8px;
        background-color: #1a1a1a;
        border: 1px solid #333;
        border-radius: 8px;
        padding: 10px 16px;
        color: #e0e0e0;
        cursor: pointer;
        transition: all 0.2s;
      }

      .user-btn:hover {
        background-color: #222;
        border-color: #00ff88;
      }

      .user-icon {
        font-size: 18px;
      }

      .user-name {
        font-size: 14px;
      }

      .user-dropdown {
        display: none;
        position: absolute;
        top: 100%;
        right: 0;
        margin-top: 8px;
        background-color: #1a1a1a;
        border: 1px solid #333;
        border-radius: 8px;
        overflow: hidden;
        min-width: 150px;
      }

      .user-dropdown.show {
        display: block;
      }

      .logout-btn {
        display: flex;
        align-items: center;
        gap: 8px;
        width: 100%;
        padding: 12px 16px;
        background: none;
        border: none;
        color: #ff6b6b;
        cursor: pointer;
        font-size: 14px;
        transition: background-color 0.2s;
      }

      .logout-btn:hover {
        background-color: rgba(255, 107, 107, 0.1);
      }

      @media (max-width: 768px) {
        .user-profile {
          top: 15px;
          right: 15px;
        }

        .user-btn {
          padding: 8px 12px;
        }

        .user-name {
          display: none;
        }
      }

      /* ==================== Ï¢ÖÌï© Í≥ÑÏÇ∞Í∏∞ Ïä§ÌÉÄÏùº ==================== */
      .calc-container {
        max-width: 800px;
      }

      .calc-tabs {
        display: flex;
        gap: 10px;
        margin-bottom: 25px;
      }

      .calc-tab {
        flex: 1;
        padding: 14px 20px;
        background-color: #1a1a1a;
        border: 1px solid #333;
        border-radius: 10px;
        color: #888;
        font-size: 15px;
        cursor: pointer;
        transition: all 0.2s;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
      }

      .calc-tab:hover {
        background-color: #222;
        color: #fff;
      }

      .calc-tab.active {
        background-color: rgba(0, 255, 136, 0.1);
        border-color: #00ff88;
        color: #00ff88;
      }

      .calc-content {
        display: none;
      }

      .calc-content.active {
        display: block;
      }

      .calc-card {
        background-color: #1a1a1a;
        border-radius: 16px;
        padding: 30px;
      }

      .calc-header {
        margin-bottom: 25px;
      }

      .calc-header h3 {
        font-size: 20px;
        color: #fff;
        margin-bottom: 8px;
      }

      .calc-header p {
        color: #666;
        font-size: 14px;
      }

      .calc-inputs {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 20px;
        margin-bottom: 25px;
      }

      .input-group {
        display: flex;
        flex-direction: column;
        gap: 8px;
      }

      .input-group label {
        color: #888;
        font-size: 14px;
      }

      .input-wrapper {
        display: flex;
        align-items: center;
        background-color: #222;
        border: 1px solid #333;
        border-radius: 8px;
        overflow: hidden;
        transition: border-color 0.2s;
      }

      .input-wrapper:focus-within {
        border-color: #00ff88;
      }

      .input-wrapper input {
        flex: 1;
        padding: 14px 16px;
        background: none;
        border: none;
        color: #fff;
        font-size: 16px;
        outline: none;
      }

      .input-wrapper input::placeholder {
        color: #555;
      }

      .input-suffix {
        padding-right: 16px;
        color: #666;
        font-size: 14px;
      }

      .calc-btn {
        width: 100%;
        padding: 16px;
        background: linear-gradient(135deg, #00ff88, #00cc6a);
        border: none;
        border-radius: 10px;
        color: #000;
        font-size: 16px;
        font-weight: 600;
        cursor: pointer;
        transition: transform 0.2s, box-shadow 0.2s;
      }

      .calc-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 20px rgba(0, 255, 136, 0.3);
      }

      .calc-results {
        margin-top: 30px;
        display: flex;
        flex-direction: column;
        gap: 15px;
      }

      .result-card {
        background-color: #222;
        border-radius: 12px;
        padding: 20px;
        border-left: 4px solid #333;
      }

      .result-card.coupang {
        border-left-color: #ff6b35;
      }

      .result-card.smartstore {
        border-left-color: #03c75a;
      }

      .result-card.esm {
        border-left-color: #4a90d9;
      }

      .result-platform {
        display: flex;
        align-items: center;
        gap: 10px;
        margin-bottom: 15px;
      }

      .platform-icon {
        font-size: 20px;
      }

      .platform-name {
        font-size: 16px;
        font-weight: 500;
        color: #fff;
      }

      .platform-fee {
        margin-left: auto;
        font-size: 12px;
        color: #666;
        background-color: #333;
        padding: 4px 10px;
        border-radius: 20px;
      }

      .result-values {
        display: flex;
        gap: 30px;
      }

      .result-item {
        display: flex;
        flex-direction: column;
        gap: 4px;
      }

      .result-label {
        font-size: 13px;
        color: #666;
      }

      .result-value {
        font-size: 22px;
        font-weight: 600;
        color: #e0e0e0;
      }

      .result-value.highlight {
        color: #00ff88;
      }

      .result-value.negative {
        color: #ff6b6b;
      }

      /* Ïä¨ÎùºÏù¥Îçî Ïä§ÌÉÄÏùº */
      .slider-container {
        background-color: #222;
        border-radius: 12px;
        padding: 20px;
        margin-bottom: 25px;
      }

      .slider-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 15px;
      }

      .slider-header label {
        color: #888;
        font-size: 14px;
      }

      .slider-value {
        font-size: 24px;
        font-weight: 700;
        color: #00ff88;
      }

      .margin-slider {
        width: 100%;
        height: 8px;
        -webkit-appearance: none;
        background: linear-gradient(
          to right,
          #333 0%,
          #00ff88 var(--value, 20%),
          #333 var(--value, 20%)
        );
        border-radius: 4px;
        outline: none;
        cursor: pointer;
      }

      .margin-slider::-webkit-slider-thumb {
        -webkit-appearance: none;
        width: 24px;
        height: 24px;
        background: #00ff88;
        border-radius: 50%;
        cursor: pointer;
        box-shadow: 0 2px 10px rgba(0, 255, 136, 0.4);
        transition: transform 0.2s;
      }

      .margin-slider::-webkit-slider-thumb:hover {
        transform: scale(1.1);
      }

      .margin-slider::-moz-range-thumb {
        width: 24px;
        height: 24px;
        background: #00ff88;
        border-radius: 50%;
        cursor: pointer;
        border: none;
      }

      .slider-labels {
        display: flex;
        justify-content: space-between;
        margin-top: 10px;
        font-size: 12px;
        color: #555;
      }

      .price-results {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 15px;
      }

      .price-result-card {
        background-color: #222;
        border-radius: 12px;
        padding: 20px;
        text-align: center;
        border-top: 3px solid #333;
        transition: transform 0.2s;
      }

      .price-result-card:hover {
        transform: translateY(-3px);
      }

      .price-result-card.coupang {
        border-top-color: #ff6b35;
      }

      .price-result-card.smartstore {
        border-top-color: #03c75a;
      }

      .price-result-card.esm {
        border-top-color: #4a90d9;
      }

      .price-platform {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
        margin-bottom: 12px;
        font-size: 14px;
        color: #888;
      }

      .price-value {
        font-size: 26px;
        font-weight: 700;
        color: #00ff88;
        margin-bottom: 8px;
      }

      .price-note {
        font-size: 12px;
        color: #555;
      }

      /* Î∞òÏùëÌòï - ÌÉúÎ∏îÎ¶ø */
      @media (max-width: 1024px) {
        .calc-container {
          max-width: 100%;
        }

        .price-results {
          grid-template-columns: repeat(3, 1fr);
          gap: 10px;
        }
      }

      /* Î∞òÏùëÌòï - Î™®Î∞îÏùº */
      @media (max-width: 768px) {
        .calc-container {
          padding: 0;
        }

        .calc-tabs {
          flex-direction: row;
          gap: 8px;
        }

        .calc-tab {
          padding: 12px 10px;
          font-size: 13px;
          gap: 5px;
        }

        .calc-card {
          padding: 20px 15px;
          border-radius: 12px;
        }

        .calc-header h3 {
          font-size: 18px;
        }

        .calc-header p {
          font-size: 13px;
        }

        .calc-inputs {
          grid-template-columns: 1fr 1fr;
          gap: 12px;
        }

        .input-group label {
          font-size: 13px;
        }

        .input-wrapper input {
          padding: 12px 14px;
          font-size: 16px; /* iOS Ï§å Î∞©ÏßÄ */
        }

        .input-suffix {
          font-size: 13px;
          padding-right: 12px;
        }

        .calc-btn {
          padding: 14px;
          font-size: 15px;
        }

        .result-card {
          padding: 16px;
        }

        .result-platform {
          flex-wrap: wrap;
          gap: 8px;
          margin-bottom: 12px;
        }

        .platform-name {
          font-size: 15px;
        }

        .platform-fee {
          font-size: 11px;
          padding: 3px 8px;
        }

        .result-values {
          flex-direction: row;
          justify-content: space-between;
          gap: 15px;
        }

        .result-item {
          flex: 1;
        }

        .result-label {
          font-size: 12px;
        }

        .result-value {
          font-size: 20px;
        }

        /* Ïä¨ÎùºÏù¥Îçî Î™®Î∞îÏùº ÏµúÏ†ÅÌôî */
        .slider-container {
          padding: 16px;
        }

        .slider-header {
          margin-bottom: 20px;
        }

        .slider-value {
          font-size: 28px;
        }

        .margin-slider {
          height: 10px;
        }

        .margin-slider::-webkit-slider-thumb {
          width: 28px;
          height: 28px;
        }

        .margin-slider::-moz-range-thumb {
          width: 28px;
          height: 28px;
        }

        .slider-labels {
          margin-top: 12px;
          font-size: 11px;
        }

        /* ÌåêÎß§Í∞Ä Í≤∞Í≥º Ïπ¥Îìú */
        .price-results {
          grid-template-columns: 1fr;
          gap: 12px;
        }

        .price-result-card {
          padding: 16px;
          display: flex;
          align-items: center;
          justify-content: space-between;
          text-align: left;
        }

        .price-platform {
          margin-bottom: 0;
          font-size: 13px;
        }

        .price-value {
          font-size: 22px;
          margin-bottom: 0;
        }

        .price-note {
          display: none;
        }
      }

      /* Î∞òÏùëÌòï - ÏûëÏùÄ Î™®Î∞îÏùº */
      @media (max-width: 400px) {
        .calc-inputs {
          grid-template-columns: 1fr;
        }

        .result-values {
          flex-direction: column;
          gap: 12px;
        }

        .result-value {
          font-size: 24px;
        }

        .price-result-card {
          flex-direction: column;
          text-align: center;
          gap: 8px;
        }

        .price-value {
          font-size: 26px;
        }

        .price-note {
          display: block;
        }
      }
    </style>
  </head>
  <body>
    <!-- Ïú†Ï†Ä ÌîÑÎ°úÌïÑ -->
    <div class="user-profile">
      <div class="user-btn" id="userBtn">
        <span class="user-icon">üë§</span>
        <span class="user-name">Ìö®ÏßÑÏú†ÌÜµ Îã¥ÎãπÏûê</span>
      </div>
      <div class="user-dropdown" id="userDropdown">
        <button class="logout-btn" onclick="location.href='/logout'">
          <span>üö™</span>
          <span>Î°úÍ∑∏ÏïÑÏõÉ</span>
        </button>
      </div>
    </div>

    <!-- ÏÇ¨Ïù¥ÎìúÎ∞î -->
    <nav class="sidebar">
      <div class="logo" id="logoBtn" style="cursor: pointer">‚ö° Ìö®ÏßÑÏú†ÌÜµ</div>
      <div class="nav-item active" data-page="home">Ìôà</div>
      <div class="nav-item" data-page="margin">ÏõêÍ∞Ä ÎßàÏßÑÌëú</div>
      <div class="nav-item" data-page="calculator">Ï¢ÖÌï© Í≥ÑÏÇ∞Í∏∞</div>
      <div class="nav-item" data-page="classify">ÏÜ°Ïû• Î∂ÑÎ•ò</div>
      <div class="nav-item" data-page="starfilter">Ïä§ÌÉÄÎ∞∞ÏÜ° ÌïÑÌÑ∞ÎßÅ</div>
      <div class="nav-item" data-page="employees">ÏßÅÏõê Í¥ÄÎ¶¨</div>
      <div class="nav-item" data-page="admin-attendance">ÏßÅÏõê Ï∂úÌá¥Í∑ºÏùºÏßÄ</div>
    </nav>

    <!-- Î©îÏù∏ ÏΩòÌÖêÏ∏† -->
    <main class="main-content">
      <!-- Ìôà ÌéòÏù¥ÏßÄ -->
      <section id="page-home" class="page">
        <h1 class="page-title">Ìôà</h1>
        <p class="page-description">Ìö®ÏßÑÏú†ÌÜµ ÏóÖÎ¨¥ ÏûêÎèôÌôî ÏãúÏä§ÌÖú</p>

        <!-- ÏàòÏ†ï ÏöîÏ≤≠ ÏïåÎ¶º ÏÑπÏÖò (Í¥ÄÎ¶¨ÏûêÏö©) -->
        <div id="editRequestsSection" style="margin-top: 30px; display: none">
          <h3
            style="
              color: #ffd700;
              margin-bottom: 15px;
              display: flex;
              align-items: center;
              gap: 10px;
            "
          >
            <span>üì¨</span> Ï∂úÌá¥Í∑º ÏàòÏ†ï ÏöîÏ≤≠
            <span
              id="editRequestCount"
              style="
                background: #ff6b6b;
                color: #fff;
                padding: 2px 8px;
                border-radius: 12px;
                font-size: 13px;
              "
              >0</span
            >
          </h3>
          <div
            id="editRequestsList"
            style="display: flex; flex-direction: column; gap: 10px"
          >
            <!-- ÎèôÏ†Å ÏÉùÏÑ± -->
          </div>
        </div>
      </section>

      <!-- ÏàòÏ†ï ÏöîÏ≤≠ Ïó¥Îûå Î™®Îã¨ -->
      <div
        class="modal-overlay"
        id="editRequestViewModal"
        style="display: none"
      >
        <div class="modal" style="max-width: 450px">
          <div class="modal-header">
            <div class="modal-icon">üìù</div>
            <div class="modal-title">Ï∂úÌá¥Í∑º ÏàòÏ†ï ÏöîÏ≤≠</div>
            <div class="modal-subtitle" id="editRequestViewSubtitle"></div>
          </div>

          <div style="padding: 20px 0">
            <!-- ÏàòÏ†ï Ï†Ñ -->
            <div style="margin-bottom: 20px">
              <div style="color: #888; font-size: 13px; margin-bottom: 8px">
                ÏàòÏ†ï Ï†Ñ
              </div>
              <div style="display: flex; gap: 20px; justify-content: center">
                <div
                  style="
                    background: #222;
                    padding: 12px 25px;
                    border-radius: 8px;
                    text-align: center;
                  "
                >
                  <div style="color: #666; font-size: 12px">Ï∂úÍ∑º</div>
                  <div
                    id="viewOldClockIn"
                    style="color: #ff6b6b; font-size: 18px; font-weight: 600"
                  >
                    --:--
                  </div>
                </div>
                <div
                  style="
                    background: #222;
                    padding: 12px 25px;
                    border-radius: 8px;
                    text-align: center;
                  "
                >
                  <div style="color: #666; font-size: 12px">Ìá¥Í∑º</div>
                  <div
                    id="viewOldClockOut"
                    style="color: #ff6b6b; font-size: 18px; font-weight: 600"
                  >
                    --:--
                  </div>
                </div>
              </div>
            </div>

            <!-- ÌôîÏÇ¥Ìëú -->
            <div
              style="
                text-align: center;
                color: #00ff88;
                font-size: 24px;
                margin: 15px 0;
              "
            >
              ‚¨áÔ∏è
            </div>

            <!-- ÏàòÏ†ï ÌõÑ -->
            <div style="margin-bottom: 20px">
              <div style="color: #888; font-size: 13px; margin-bottom: 8px">
                ÏàòÏ†ï ÌõÑ
              </div>
              <div style="display: flex; gap: 20px; justify-content: center">
                <div
                  style="
                    background: rgba(0, 255, 136, 0.1);
                    border: 1px solid #00ff88;
                    padding: 12px 25px;
                    border-radius: 8px;
                    text-align: center;
                  "
                >
                  <div style="color: #666; font-size: 12px">Ï∂úÍ∑º</div>
                  <div
                    id="viewNewClockIn"
                    style="color: #00ff88; font-size: 18px; font-weight: 600"
                  >
                    --:--
                  </div>
                </div>
                <div
                  style="
                    background: rgba(0, 255, 136, 0.1);
                    border: 1px solid #00ff88;
                    padding: 12px 25px;
                    border-radius: 8px;
                    text-align: center;
                  "
                >
                  <div style="color: #666; font-size: 12px">Ìá¥Í∑º</div>
                  <div
                    id="viewNewClockOut"
                    style="color: #00ff88; font-size: 18px; font-weight: 600"
                  >
                    --:--
                  </div>
                </div>
              </div>
            </div>

            <!-- ÏàòÏ†ï ÏÇ¨Ïú† -->
            <div
              style="
                background: #1a1a1a;
                border-radius: 8px;
                padding: 15px;
                margin-top: 20px;
              "
            >
              <div style="color: #888; font-size: 13px; margin-bottom: 8px">
                üìã ÏàòÏ†ï ÏÇ¨Ïú†
              </div>
              <div
                id="viewReason"
                style="color: #e0e0e0; font-size: 14px; line-height: 1.6"
              ></div>
            </div>
          </div>

          <div class="modal-actions" style="display: flex; gap: 10px">
            <button
              class="btn btn-outline"
              onclick="closeEditRequestViewModal()"
              style="flex: 1"
            >
              Îã´Í∏∞
            </button>
            <button
              class="btn"
              onclick="rejectEditRequest()"
              style="flex: 1; background: #ff6b6b; color: #fff"
            >
              Í±∞Ï†à
            </button>
            <button
              class="btn btn-primary"
              onclick="approveEditRequest()"
              style="flex: 1"
            >
              ÏàòÎùΩ
            </button>
          </div>
        </div>
      </div>

      <!-- Í±∞Ï†à ÏÇ¨Ïú† ÏûÖÎ†• Î™®Îã¨ -->
      <div class="modal-overlay" id="rejectReasonModal" style="display: none">
        <div class="modal" style="max-width: 400px">
          <div class="modal-header">
            <div class="modal-icon" style="color: #ff6b6b">‚ùå</div>
            <div class="modal-title">Í±∞Ï†à ÏÇ¨Ïú† ÏûÖÎ†•</div>
            <div class="modal-subtitle">Í±∞Ï†à ÏÇ¨Ïú†Î•º ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî</div>
          </div>

          <div style="padding: 20px 0">
            <textarea
              id="rejectReasonInput"
              rows="4"
              placeholder="Í±∞Ï†à ÏÇ¨Ïú†Î•º ÏûÖÎ†•ÌïòÏÑ∏Ïöî"
              style="
                width: 100%;
                padding: 12px;
                background: #1a1a1a;
                border: 1px solid #333;
                border-radius: 8px;
                color: #fff;
                font-size: 14px;
                resize: none;
              "
            ></textarea>
          </div>

          <div class="modal-actions" style="display: flex; gap: 10px">
            <button
              class="btn btn-outline"
              onclick="closeRejectReasonModal()"
              style="flex: 1"
            >
              Ï∑®ÏÜå
            </button>
            <button
              class="btn"
              onclick="submitRejectReason()"
              style="flex: 1; background: #ff6b6b; color: #fff"
            >
              Ï†ÑÏÜ°
            </button>
          </div>
        </div>
      </div>

      <!-- ÏõêÍ∞Ä ÎßàÏßÑÌëú ÌéòÏù¥ÏßÄ -->
      <section id="page-margin" class="page" style="display: none">
        <div class="margin-container">
          <div class="margin-header">
            <h1 class="page-title">üìä ÏõêÍ∞Ä ÎßàÏßÑÌëú</h1>
            <p class="page-description">
              ÏÉÅÌíàÎ≥Ñ ÏõêÍ∞Ä Î∞è ÎßàÏßÑ Ï†ïÎ≥¥Î•º Ï°∞ÌöåÌï©ÎãàÎã§
            </p>
          </div>

          <!-- Í≤ÄÏÉâ ÏòÅÏó≠ -->
          <div class="search-container">
            <div
              style="
                display: flex;
                gap: 10px;
                align-items: center;
                flex-wrap: wrap;
              "
            >
              <div class="search-box" style="flex: 1; min-width: 200px">
                <span class="search-icon">üîç</span>
                <input
                  type="text"
                  id="marginSearch"
                  class="search-input"
                  placeholder="ÏÉÅÌíàÎ™Ö Í≤ÄÏÉâ..."
                  autocomplete="off"
                />
                <button
                  class="search-clear"
                  id="searchClear"
                  style="display: none"
                >
                  ‚úï
                </button>
              </div>
              <button
                class="btn btn-primary"
                id="addMarginBtn"
                onclick="showAddMarginModal()"
                style="white-space: nowrap; display: none"
              >
                ‚ûï ÏÉÅÌíà Ï∂îÍ∞Ä
              </button>
            </div>
            <div class="search-result-count" id="resultCount">Ï¥ù 0Í∞ú ÏÉÅÌíà</div>
          </div>

          <!-- ÌÖåÏù¥Î∏î ÏòÅÏó≠ -->
          <div class="table-container" id="marginTableContainer">
            <div class="loading-data">Îç∞Ïù¥ÌÑ∞ Î°úÎî©Ï§ë...</div>
          </div>
        </div>

        <!-- ÏõêÍ∞Ä ÎßàÏßÑÌëú Ï∂îÍ∞Ä/ÏàòÏ†ï Î™®Îã¨ (DB Ïó∞Í≤∞ ÏãúÏóêÎßå ÏÇ¨Ïö©) -->
        <div class="modal-overlay" id="marginProductModal">
          <div class="modal" style="max-width: 600px">
            <div class="modal-header">
              <div class="modal-icon">üì¶</div>
              <div class="modal-title" id="marginModalTitle">ÏÉÅÌíà Ï∂îÍ∞Ä</div>
              <div class="modal-subtitle">ÏõêÍ∞Ä Î∞è ÎßàÏßÑ Ï†ïÎ≥¥ ÏûÖÎ†•</div>
            </div>

            <div style="max-height: 400px; overflow-y: auto; padding: 0 5px">
              <div style="display: grid; grid-template-columns: 1fr; gap: 12px">
                <div>
                  <label
                    style="
                      display: block;
                      color: #888;
                      font-size: 13px;
                      margin-bottom: 5px;
                    "
                    >ÏÉÅÌíàÎ™Ö *</label
                  >
                  <input
                    type="text"
                    id="marginName"
                    placeholder="ÏÉÅÌíàÎ™Ö"
                    style="
                      width: 100%;
                      padding: 12px;
                      background: #222;
                      border: 1px solid #333;
                      border-radius: 8px;
                      color: #fff;
                      font-size: 14px;
                      box-sizing: border-box;
                    "
                  />
                </div>
                <div
                  style="
                    display: grid;
                    grid-template-columns: 1fr 1fr;
                    gap: 12px;
                  "
                >
                  <div>
                    <label
                      style="
                        display: block;
                        color: #888;
                        font-size: 13px;
                        margin-bottom: 5px;
                      "
                      >Ïù∏ÏÉÅÏ†Ñ ÏÉÅÌíàÍ∞Ä</label
                    >
                    <input
                      type="number"
                      id="marginPrePrice"
                      placeholder="0"
                      style="
                        width: 100%;
                        padding: 12px;
                        background: #222;
                        border: 1px solid #333;
                        border-radius: 8px;
                        color: #fff;
                        box-sizing: border-box;
                      "
                    />
                  </div>
                  <div>
                    <label
                      style="
                        display: block;
                        color: #888;
                        font-size: 13px;
                        margin-bottom: 5px;
                      "
                      >Ïù∏ÏÉÅÌõÑ ÏÉÅÌíàÍ∞Ä</label
                    >
                    <input
                      type="number"
                      id="marginPostPrice"
                      placeholder="0"
                      style="
                        width: 100%;
                        padding: 12px;
                        background: #222;
                        border: 1px solid #333;
                        border-radius: 8px;
                        color: #fff;
                        box-sizing: border-box;
                      "
                    />
                  </div>
                </div>
                <div
                  style="
                    display: grid;
                    grid-template-columns: 1fr 1fr 1fr;
                    gap: 12px;
                  "
                >
                  <div>
                    <label
                      style="
                        display: block;
                        color: #888;
                        font-size: 13px;
                        margin-bottom: 5px;
                      "
                      >Î¨ºÎüâÏßÄÏõê</label
                    >
                    <input
                      type="number"
                      id="marginSupply"
                      placeholder="1"
                      step="0.1"
                      style="
                        width: 100%;
                        padding: 12px;
                        background: #222;
                        border: 1px solid #333;
                        border-radius: 8px;
                        color: #fff;
                        box-sizing: border-box;
                      "
                    />
                  </div>
                  <div>
                    <label
                      style="
                        display: block;
                        color: #888;
                        font-size: 13px;
                        margin-bottom: 5px;
                      "
                      >ÌîÑÎ°úÎ™®ÏÖòÌï†Ïù∏Î•†</label
                    >
                    <input
                      type="number"
                      id="marginPromo"
                      placeholder="0"
                      step="0.01"
                      style="
                        width: 100%;
                        padding: 12px;
                        background: #222;
                        border: 1px solid #333;
                        border-radius: 8px;
                        color: #fff;
                        box-sizing: border-box;
                      "
                    />
                  </div>
                  <div>
                    <label
                      style="
                        display: block;
                        color: #888;
                        font-size: 13px;
                        margin-bottom: 5px;
                      "
                      >Ïû•Î†§Í∏àÎ•†</label
                    >
                    <input
                      type="number"
                      id="marginIncentive"
                      placeholder="0"
                      step="0.01"
                      style="
                        width: 100%;
                        padding: 12px;
                        background: #222;
                        border: 1px solid #333;
                        border-radius: 8px;
                        color: #fff;
                        box-sizing: border-box;
                      "
                    />
                  </div>
                </div>
                <div
                  style="
                    display: grid;
                    grid-template-columns: 1fr 1fr;
                    gap: 12px;
                  "
                >
                  <div>
                    <label
                      style="
                        display: block;
                        color: #888;
                        font-size: 13px;
                        margin-bottom: 5px;
                      "
                      >Î∞∞ÏÜ°ÎπÑ</label
                    >
                    <input
                      type="number"
                      id="marginShipping"
                      placeholder="0"
                      style="
                        width: 100%;
                        padding: 12px;
                        background: #222;
                        border: 1px solid #333;
                        border-radius: 8px;
                        color: #fff;
                        box-sizing: border-box;
                      "
                    />
                  </div>
                  <div>
                    <label
                      style="
                        display: block;
                        color: #888;
                        font-size: 13px;
                        margin-bottom: 5px;
                      "
                      >Î∞ïÏä§ÎπÑ</label
                    >
                    <input
                      type="number"
                      id="marginBox"
                      placeholder="0"
                      style="
                        width: 100%;
                        padding: 12px;
                        background: #222;
                        border: 1px solid #333;
                        border-radius: 8px;
                        color: #fff;
                        box-sizing: border-box;
                      "
                    />
                  </div>
                </div>
                <div
                  style="
                    display: grid;
                    grid-template-columns: 1fr 1fr;
                    gap: 12px;
                  "
                >
                  <div>
                    <label
                      style="
                        display: block;
                        color: #888;
                        font-size: 13px;
                        margin-bottom: 5px;
                      "
                      >Ïù∏ÏÉÅÏ†Ñ Ï¥ù ÏõêÍ∞Ä</label
                    >
                    <input
                      type="number"
                      id="marginPreCost"
                      placeholder="0"
                      style="
                        width: 100%;
                        padding: 12px;
                        background: #222;
                        border: 1px solid #333;
                        border-radius: 8px;
                        color: #fff;
                        box-sizing: border-box;
                      "
                    />
                  </div>
                  <div>
                    <label
                      style="
                        display: block;
                        color: #888;
                        font-size: 13px;
                        margin-bottom: 5px;
                      "
                      >Ïù∏ÏÉÅÌõÑ Ï¥ù ÏõêÍ∞Ä</label
                    >
                    <input
                      type="number"
                      id="marginPostCost"
                      placeholder="0"
                      style="
                        width: 100%;
                        padding: 12px;
                        background: #222;
                        border: 1px solid #333;
                        border-radius: 8px;
                        color: #fff;
                        box-sizing: border-box;
                      "
                    />
                  </div>
                </div>
                <div
                  style="
                    display: grid;
                    grid-template-columns: 1fr 1fr 1fr;
                    gap: 12px;
                  "
                >
                  <div>
                    <label
                      style="
                        display: block;
                        color: #888;
                        font-size: 13px;
                        margin-bottom: 5px;
                      "
                      >Ïù∏ÏÉÅÏ†Ñ Ïû¨Í≥†</label
                    >
                    <select
                      id="marginStock"
                      style="
                        width: 100%;
                        padding: 12px;
                        background: #222;
                        border: 1px solid #333;
                        border-radius: 8px;
                        color: #fff;
                        box-sizing: border-box;
                      "
                    >
                      <option value="">ÏÑ†ÌÉù</option>
                      <option value="o">O (ÏûàÏùå)</option>
                      <option value="x">X (ÏóÜÏùå)</option>
                    </select>
                  </div>
                  <div>
                    <label
                      style="
                        display: block;
                        color: #888;
                        font-size: 13px;
                        margin-bottom: 5px;
                      "
                      >1Î∞ïÏä§ ÏµúÎåÄ ÏàòÎüâ</label
                    >
                    <input
                      type="text"
                      id="marginBoxQty"
                      placeholder=""
                      style="
                        width: 100%;
                        padding: 12px;
                        background: #222;
                        border: 1px solid #333;
                        border-radius: 8px;
                        color: #fff;
                        box-sizing: border-box;
                      "
                    />
                  </div>
                  <div>
                    <label
                      style="
                        display: block;
                        color: #888;
                        font-size: 13px;
                        margin-bottom: 5px;
                      "
                      >Í∏∞ÌÉÄÏÇ¨Ìï≠</label
                    >
                    <input
                      type="text"
                      id="marginNote"
                      placeholder=""
                      style="
                        width: 100%;
                        padding: 12px;
                        background: #222;
                        border: 1px solid #333;
                        border-radius: 8px;
                        color: #fff;
                        box-sizing: border-box;
                      "
                    />
                  </div>
                </div>
              </div>
            </div>

            <input type="hidden" id="marginEditId" />

            <div class="modal-actions" style="margin-top: 20px">
              <button class="btn btn-primary" onclick="saveMarginProduct()">
                Ï†ÄÏû•
              </button>
              <button class="btn btn-outline" onclick="closeMarginModal()">
                Ï∑®ÏÜå
              </button>
            </div>
          </div>
        </div>
      </section>

      <!-- Ï¢ÖÌï© Í≥ÑÏÇ∞Í∏∞ ÌéòÏù¥ÏßÄ -->
      <section id="page-calculator" class="page" style="display: none">
        <div class="calc-container">
          <h1 class="page-title">üßÆ Ï¢ÖÌï© Í≥ÑÏÇ∞Í∏∞</h1>
          <p class="page-description">ÎßàÏßÑ Í≥ÑÏÇ∞ Î∞è ÌåêÎß§Í∞Ä Ï±ÖÏ†ïÏùÑ ÏúÑÌïú Í≥ÑÏÇ∞Í∏∞</p>

          <!-- Í≥ÑÏÇ∞Í∏∞ ÌÉ≠ -->
          <div class="calc-tabs">
            <button class="calc-tab active" data-calc="margin">
              üí∞ ÎßàÏßÑ Í≥ÑÏÇ∞Í∏∞
            </button>
            <button class="calc-tab" data-calc="price">üè∑Ô∏è ÌåêÎß§Í∞Ä Ï±ÖÏ†ïÍ∏∞</button>
          </div>

          <!-- ÎßàÏßÑ Í≥ÑÏÇ∞Í∏∞ -->
          <div class="calc-content active" id="calc-margin">
            <div class="calc-card">
              <div class="calc-header">
                <h3>ÎßàÏßÑ Í≥ÑÏÇ∞Í∏∞</h3>
                <p>ÌòÑÏû¨ ÌåêÎß§Í∞Ä Í∏∞Ï§ÄÏúºÎ°ú ÌîåÎû´ÌèºÎ≥Ñ ÎßàÏßÑÏùÑ Í≥ÑÏÇ∞Ìï©ÎãàÎã§</p>
              </div>

              <div class="calc-inputs">
                <div class="input-group">
                  <label>ÌòÑÏû¨ ÌåêÎß§Í∞Ä</label>
                  <div class="input-wrapper">
                    <input
                      type="number"
                      id="marginSalePrice"
                      placeholder="0"
                      min="0"
                    />
                    <span class="input-suffix">Ïõê</span>
                  </div>
                </div>
                <div class="input-group">
                  <label>ÏÉÅÌíà ÏõêÍ∞Ä</label>
                  <div class="input-wrapper">
                    <input
                      type="number"
                      id="marginCost"
                      placeholder="0"
                      min="0"
                    />
                    <span class="input-suffix">Ïõê</span>
                  </div>
                </div>
                <div class="input-group">
                  <label>Î∞∞ÏÜ°ÎπÑ</label>
                  <div class="input-wrapper">
                    <input
                      type="number"
                      id="marginShipping"
                      placeholder="0"
                      min="0"
                    />
                    <span class="input-suffix">Ïõê</span>
                  </div>
                </div>
                <div class="input-group">
                  <label>Î∞ïÏä§ÎπÑ</label>
                  <div class="input-wrapper">
                    <input
                      type="number"
                      id="marginBox"
                      placeholder="0"
                      min="0"
                    />
                    <span class="input-suffix">Ïõê</span>
                  </div>
                </div>
              </div>

              <button class="calc-btn" onclick="calculateMargin()">
                Í≥ÑÏÇ∞ÌïòÍ∏∞
              </button>

              <div
                class="calc-results"
                id="marginResults"
                style="display: none"
              >
                <div class="result-card coupang">
                  <div class="result-platform">
                    <span class="platform-icon">üü†</span>
                    <span class="platform-name">Ïø†Ìå°</span>
                    <span class="platform-fee">ÏàòÏàòÎ£å 12%</span>
                  </div>
                  <div class="result-values">
                    <div class="result-item">
                      <span class="result-label">ÎßàÏßÑ</span>
                      <span class="result-value" id="coupangMargin">0Ïõê</span>
                    </div>
                    <div class="result-item">
                      <span class="result-label">ÎßàÏßÑÎ•†</span>
                      <span class="result-value highlight" id="coupangRate"
                        >0%</span
                      >
                    </div>
                  </div>
                </div>
                <div class="result-card smartstore">
                  <div class="result-platform">
                    <span class="platform-icon">üü¢</span>
                    <span class="platform-name">Ïä§ÎßàÌä∏Ïä§ÌÜ†Ïñ¥</span>
                    <span class="platform-fee">ÏàòÏàòÎ£å 6.7%</span>
                  </div>
                  <div class="result-values">
                    <div class="result-item">
                      <span class="result-label">ÎßàÏßÑ</span>
                      <span class="result-value" id="smartstoreMargin"
                        >0Ïõê</span
                      >
                    </div>
                    <div class="result-item">
                      <span class="result-label">ÎßàÏßÑÎ•†</span>
                      <span class="result-value highlight" id="smartstoreRate"
                        >0%</span
                      >
                    </div>
                  </div>
                </div>
                <div class="result-card esm">
                  <div class="result-platform">
                    <span class="platform-icon">üîµ</span>
                    <span class="platform-name">ESM (GÎßàÏºì/Ïò•ÏÖò)</span>
                    <span class="platform-fee">ÏàòÏàòÎ£å 15%</span>
                  </div>
                  <div class="result-values">
                    <div class="result-item">
                      <span class="result-label">ÎßàÏßÑ</span>
                      <span class="result-value" id="esmMargin">0Ïõê</span>
                    </div>
                    <div class="result-item">
                      <span class="result-label">ÎßàÏßÑÎ•†</span>
                      <span class="result-value highlight" id="esmRate"
                        >0%</span
                      >
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- ÌåêÎß§Í∞Ä Ï±ÖÏ†ïÍ∏∞ -->
          <div class="calc-content" id="calc-price">
            <div class="calc-card">
              <div class="calc-header">
                <h3>ÌåêÎß§Í∞Ä Ï±ÖÏ†ïÍ∏∞</h3>
                <p>ÏõêÌïòÎäî ÎßàÏßÑÎ•†Ïóê Îî∞Î•∏ ÌåêÎß§Í∞ÄÎ•º Í≥ÑÏÇ∞Ìï©ÎãàÎã§</p>
              </div>

              <div class="calc-inputs">
                <div class="input-group">
                  <label>ÏÉÅÌíà ÏõêÍ∞Ä</label>
                  <div class="input-wrapper">
                    <input
                      type="number"
                      id="priceCost"
                      placeholder="0"
                      min="0"
                    />
                    <span class="input-suffix">Ïõê</span>
                  </div>
                </div>
                <div class="input-group">
                  <label>Î∞∞ÏÜ°ÎπÑ</label>
                  <div class="input-wrapper">
                    <input
                      type="number"
                      id="priceShipping"
                      placeholder="0"
                      min="0"
                    />
                    <span class="input-suffix">Ïõê</span>
                  </div>
                </div>
                <div class="input-group">
                  <label>Î∞ïÏä§ÎπÑ</label>
                  <div class="input-wrapper">
                    <input
                      type="number"
                      id="priceBox"
                      placeholder="0"
                      min="0"
                    />
                    <span class="input-suffix">Ïõê</span>
                  </div>
                </div>
              </div>

              <div class="slider-container">
                <div class="slider-header">
                  <label>Î™©Ìëú ÎßàÏßÑÎ•†</label>
                  <span class="slider-value" id="targetMarginValue">20%</span>
                </div>
                <input
                  type="range"
                  id="targetMarginSlider"
                  class="margin-slider"
                  min="0"
                  max="100"
                  value="20"
                />
                <div class="slider-labels">
                  <span>0%</span>
                  <span>25%</span>
                  <span>50%</span>
                  <span>75%</span>
                  <span>100%</span>
                </div>
              </div>

              <div class="price-results" id="priceResults">
                <div class="price-result-card coupang">
                  <div class="price-platform">
                    <span class="platform-icon">üü†</span>
                    <span>Ïø†Ìå°</span>
                  </div>
                  <div class="price-value" id="coupangPrice">0Ïõê</div>
                  <div class="price-note">ÏàòÏàòÎ£å 12% Ï†ÅÏö©</div>
                </div>
                <div class="price-result-card smartstore">
                  <div class="price-platform">
                    <span class="platform-icon">üü¢</span>
                    <span>Ïä§ÎßàÌä∏Ïä§ÌÜ†Ïñ¥</span>
                  </div>
                  <div class="price-value" id="smartstorePrice">0Ïõê</div>
                  <div class="price-note">ÏàòÏàòÎ£å 6.7% Ï†ÅÏö©</div>
                </div>
                <div class="price-result-card esm">
                  <div class="price-platform">
                    <span class="platform-icon">üîµ</span>
                    <span>ESM</span>
                  </div>
                  <div class="price-value" id="esmPrice">0Ïõê</div>
                  <div class="price-note">ÏàòÏàòÎ£å 15% Ï†ÅÏö©</div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- Ïä§ÌÉÄÎ∞∞ÏÜ° ÌïÑÌÑ∞ ÌéòÏù¥ÏßÄ -->
      <section id="page-starfilter" class="page" style="display: none">
        <h1 class="page-title">Ïä§ÌÉÄÎ∞∞ÏÜ° ÌïÑÌÑ∞</h1>
        <p class="page-description">
          ÏóëÏÖÄ ÌååÏùºÏóêÏÑú 'ÌåêÎß§Ïûê Ïä§ÌÉÄÎ∞∞ÏÜ°' Ï£ºÎ¨∏ÏùÑ ÏûêÎèôÏúºÎ°ú Ï†úÍ±∞Ìï©ÎãàÎã§
        </p>

        <div class="upload-area" id="starUploadArea">
          <div class="upload-icon">üìä</div>
          <div class="upload-text">
            ÏóëÏÖÄ ÌååÏùºÏùÑ Ïó¨Í∏∞Ïóê ÎìúÎûòÍ∑∏ÌïòÍ±∞ÎÇò ÌÅ¥Î¶≠ÌïòÏó¨ ÏÑ†ÌÉùÌïòÏÑ∏Ïöî
          </div>
          <div class="upload-hint">.xlsx Î∞è .xls ÌòïÏãù ÏßÄÏõê ‚Ä¢ Ï¥àÍ≥†ÏÜç Ï≤òÎ¶¨</div>
          <input
            type="file"
            id="starFileInput"
            accept=".xls,.xlsx"
            style="display: none"
          />
          <div class="file-info" id="starFileInfo">
            <span>üìÑ</span>
            <span class="file-name" id="starFileName"></span>
            <span class="file-size" id="starFileSize"></span>
          </div>
        </div>

        <div class="button-group">
          <button class="btn btn-primary" id="starFilterBtn" disabled>
            ‚ö° ÌïÑÌÑ∞ ÏãúÏûë
          </button>
        </div>
      </section>

      <!-- ÏÜ°Ïû• Î∂ÑÎ•ò ÌéòÏù¥ÏßÄ -->
      <section id="page-classify" class="page" style="display: none">
        <h1 class="page-title">ÏÜ°Ïû• Î∂ÑÎ•ò</h1>
        <p class="page-description">
          Ï£ºÎ¨∏ ÏóëÏÖÄ ÌååÏùºÏùÑ Îã¥ÎãπÏûêÎ≥ÑÎ°ú ÏûêÎèô Î∂ÑÎ•òÌï©ÎãàÎã§
        </p>

        <div class="settings-info">
          üìã <span>ÌòÑÏû¨ ÏÑ§Ï†ï:</span> <span id="settingsInfo">Î°úÎî©Ï§ë...</span>
        </div>

        <!-- ÌÉ≠ -->
        <div class="tabs">
          <div class="tab active" data-tab="upload">üìÅ ÌååÏùº ÏóÖÎ°úÎìú</div>
          <div class="tab" data-tab="workers">üë• Îã¥ÎãπÏûê</div>
          <div class="tab" data-tab="analysis">üìä Í≤∞Í≥º Î∂ÑÏÑù</div>
        </div>

        <!-- ÌååÏùº ÏóÖÎ°úÎìú ÌÉ≠ -->
        <div class="tab-content active" id="tab-upload">
          <div class="upload-area" id="classifyUploadArea">
            <div class="upload-icon">üìä</div>
            <div class="upload-text">
              ÏóëÏÖÄ ÌååÏùºÏùÑ Ïó¨Í∏∞Ïóê ÎìúÎûòÍ∑∏ÌïòÍ±∞ÎÇò ÌÅ¥Î¶≠ÌïòÏó¨ ÏÑ†ÌÉùÌïòÏÑ∏Ïöî
            </div>
            <div class="upload-hint">.xlsx Î∞è .xls ÌòïÏãù ÏßÄÏõê ‚Ä¢ Ï¥àÍ≥†ÏÜç Ï≤òÎ¶¨</div>
            <input
              type="file"
              id="classifyFileInput"
              accept=".xls,.xlsx"
              style="display: none"
            />
            <div class="file-info" id="classifyFileInfo">
              <span>üìÑ</span>
              <span class="file-name" id="classifyFileName"></span>
              <span class="file-size" id="classifyFileSize"></span>
            </div>
          </div>

          <div class="button-group">
            <button class="btn btn-primary" id="classifyBtn" disabled>
              ‚ö° Î∂ÑÎ•ò ÏãúÏûë
            </button>
            <button class="btn btn-secondary" id="downloadBtn" disabled>
              üìÅ Í≤∞Í≥º Îã§Ïö¥Î°úÎìú
            </button>
            <button class="btn btn-outline" id="reviewBtn" disabled>
              üîç ÎØ∏Î∂ÑÎ•ò Í≤ÄÌÜ†
            </button>
            <label class="star-filter-checkbox">
              <input type="checkbox" id="starFilterCheck" />
              <span class="checkmark"></span>
              <span class="checkbox-label">‚≠ê Ïä§ÌÉÄÎ∞∞ÏÜ° ÌïÑÌÑ∞ÎßÅ</span>
            </label>
          </div>
        </div>

        <!-- Îã¥ÎãπÏûê ÌÉ≠ -->
        <div class="tab-content" id="tab-workers">
          <div class="workers-list" id="workersList">
            <!-- ÎèôÏ†Å ÏÉùÏÑ± -->
          </div>

          <!-- Îã¥ÎãπÏûê ÏÉÅÌíà Í∑úÏπô Î™®Îã¨ (DB Ïó∞Í≤∞ ÏãúÏóêÎßå ÏÇ¨Ïö©) -->
          <div class="modal-overlay" id="workerProductsModal">
            <div
              class="modal"
              style="
                max-width: 800px;
                max-height: 80vh;
                overflow: hidden;
                display: flex;
                flex-direction: column;
              "
            >
              <div class="modal-header" style="flex-shrink: 0">
                <div class="modal-icon" id="workerModalIcon">üìã</div>
                <div class="modal-title" id="workerModalTitle">Îã¥ÎãπÏûê</div>
                <div class="modal-subtitle" id="workerModalSubtitle">
                  ÏÉÅÌíà Í∑úÏπô Í¥ÄÎ¶¨
                </div>
              </div>

              <div
                id="workerAddBtnArea"
                style="
                  padding: 0 20px;
                  margin-bottom: 15px;
                  flex-shrink: 0;
                  display: none;
                "
              >
                <button
                  class="btn btn-primary"
                  onclick="showAddProductForm()"
                  style="width: 100%"
                >
                  ‚ûï ÏÉà ÏÉÅÌíà Í∑úÏπô Ï∂îÍ∞Ä
                </button>
              </div>

              <!-- ÏÉÅÌíà Ï∂îÍ∞Ä Ìèº (Ïà®ÍπÄ) -->
              <div
                id="addProductForm"
                style="
                  display: none;
                  padding: 0 20px;
                  margin-bottom: 15px;
                  flex-shrink: 0;
                "
              >
                <div
                  style="background: #222; border-radius: 8px; padding: 15px"
                >
                  <div
                    style="
                      display: grid;
                      grid-template-columns: 1fr 1fr 1fr;
                      gap: 10px;
                      margin-bottom: 10px;
                    "
                  >
                    <input
                      type="text"
                      id="newBrand"
                      placeholder="Î∏åÎûúÎìú (ÎπÑÏõåÎëêÎ©¥ All)"
                      style="
                        padding: 10px;
                        background: #333;
                        border: 1px solid #444;
                        border-radius: 6px;
                        color: #fff;
                      "
                    />
                    <input
                      type="text"
                      id="newProductName"
                      placeholder="ÏÉÅÌíàÎ™Ö *"
                      style="
                        padding: 10px;
                        background: #333;
                        border: 1px solid #444;
                        border-radius: 6px;
                        color: #fff;
                      "
                    />
                    <input
                      type="text"
                      id="newOrderOption"
                      placeholder="ÏòµÏÖò (ÎπÑÏõåÎëêÎ©¥ All)"
                      style="
                        padding: 10px;
                        background: #333;
                        border: 1px solid #444;
                        border-radius: 6px;
                        color: #fff;
                      "
                    />
                  </div>
                  <div style="display: flex; gap: 10px">
                    <button
                      class="btn btn-primary"
                      id="saveProductBtn"
                      onclick="saveNewProduct()"
                      style="flex: 1"
                    >
                      Ï†ÄÏû•
                    </button>
                    <button
                      class="btn btn-outline"
                      onclick="hideAddProductForm()"
                    >
                      Ï∑®ÏÜå
                    </button>
                  </div>
                </div>
              </div>

              <div
                id="workerProductsList"
                style="flex: 1; overflow-y: auto; padding: 0 20px"
              >
                <!-- ÎèôÏ†Å ÏÉùÏÑ± -->
              </div>

              <div
                class="modal-actions"
                style="flex-shrink: 0; padding-top: 15px"
              >
                <button
                  class="btn btn-outline"
                  onclick="closeWorkerProductsModal()"
                >
                  Îã´Í∏∞
                </button>
              </div>
            </div>
          </div>
        </div>

        <!-- Í≤∞Í≥º Î∂ÑÏÑù ÌÉ≠ -->
        <div class="tab-content" id="tab-analysis">
          <div class="analysis-container">
            <div class="analysis-header">
              <div class="analysis-title">Îã¥ÎãπÏûêÎ≥Ñ Ï£ºÎ¨∏ ÌòÑÌô©</div>
              <div class="analysis-desc">
                Í∞ÄÏû• ÏµúÍ∑º Î∂ÑÎ•ò Í≤∞Í≥ºÎ•º Í∏∞Ï§ÄÏúºÎ°ú ÌëúÏãúÎê©ÎãàÎã§
              </div>
            </div>
            <div id="analysisContent">
              <div class="no-data">
                <div class="no-data-icon">üìä</div>
                <div>Î∂ÑÎ•ò Í≤∞Í≥ºÍ∞Ä ÏóÜÏäµÎãàÎã§</div>
                <div style="margin-top: 8px; font-size: 13px">
                  ÌååÏùºÏùÑ ÏóÖÎ°úÎìúÌïòÍ≥† Î∂ÑÎ•òÎ•º ÏãúÏûëÌï¥Ï£ºÏÑ∏Ïöî
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- ÏßÅÏõê Í¥ÄÎ¶¨ ÌéòÏù¥ÏßÄ -->
      <section id="page-employees" class="page" style="display: none">
        <h1 class="page-title">ÏßÅÏõê Í¥ÄÎ¶¨</h1>
        <p class="page-description">ÏïåÎ∞îÏÉù Í≥ÑÏ†ï Î∞è Í∏âÏó¨ ÏÑ§Ï†ïÏùÑ Í¥ÄÎ¶¨Ìï©ÎãàÎã§</p>

        <div class="content-card">
          <div
            style="
              display: flex;
              justify-content: space-between;
              align-items: center;
              margin-bottom: 20px;
            "
          >
            <h3>üë• ÏßÅÏõê Î™©Î°ù</h3>
            <button class="btn btn-primary" onclick="showAddEmployeeModal()">
              ‚ûï ÏßÅÏõê Ï∂îÍ∞Ä
            </button>
          </div>

          <div id="employeeList">
            <div style="text-align: center; padding: 40px; color: #666">
              Î°úÎî©Ï§ë...
            </div>
          </div>
        </div>

        <!-- Í≥µÌú¥Ïùº Í¥ÄÎ¶¨ -->
        <div class="content-card" style="margin-top: 20px">
          <div
            style="
              display: flex;
              justify-content: space-between;
              align-items: center;
              margin-bottom: 20px;
            "
          >
            <h3>üìÖ Í≥µÌú¥Ïùº Í¥ÄÎ¶¨</h3>
            <button class="btn btn-primary" onclick="showAddHolidayModal()">
              ‚ûï Í≥µÌú¥Ïùº Ï∂îÍ∞Ä
            </button>
          </div>

          <div style="margin-bottom: 15px">
            <select
              id="holidayYear"
              onchange="loadHolidays()"
              style="
                padding: 8px 12px;
                background: #222;
                border: 1px solid #333;
                border-radius: 6px;
                color: #fff;
                margin-right: 10px;
              "
            >
              <option value="2025">2025ÎÖÑ</option>
              <option value="2026">2026ÎÖÑ</option>
            </select>
            <select
              id="holidayMonth"
              onchange="loadHolidays()"
              style="
                padding: 8px 12px;
                background: #222;
                border: 1px solid #333;
                border-radius: 6px;
                color: #fff;
              "
            >
              <option value="1">1Ïõî</option>
              <option value="2">2Ïõî</option>
              <option value="3">3Ïõî</option>
              <option value="4">4Ïõî</option>
              <option value="5">5Ïõî</option>
              <option value="6">6Ïõî</option>
              <option value="7">7Ïõî</option>
              <option value="8">8Ïõî</option>
              <option value="9">9Ïõî</option>
              <option value="10">10Ïõî</option>
              <option value="11">11Ïõî</option>
              <option value="12">12Ïõî</option>
            </select>
          </div>

          <div id="holidayList">
            <div style="text-align: center; padding: 20px; color: #666">
              Îì±Î°ùÎêú Í≥µÌú¥ÏùºÏù¥ ÏóÜÏäµÎãàÎã§
            </div>
          </div>
        </div>
      </section>

      <!-- ÏßÅÏõê Ï∂úÌá¥Í∑ºÏùºÏßÄ ÌéòÏù¥ÏßÄ -->
      <section id="page-admin-attendance" class="page" style="display: none">
        <h1 class="page-title">ÏßÅÏõê Ï∂úÌá¥Í∑ºÏùºÏßÄ</h1>
        <p class="page-description">ÏßÅÏõêÎì§Ïùò Ï∂úÌá¥Í∑º Í∏∞Î°ùÏùÑ Ï°∞ÌöåÌï©ÎãàÎã§</p>

        <div class="content-card">
          <div
            style="
              display: flex;
              gap: 15px;
              margin-bottom: 20px;
              flex-wrap: wrap;
              align-items: center;
            "
          >
            <select
              id="adminAttYear"
              onchange="loadAdminAttendance()"
              style="
                padding: 10px 15px;
                background: #222;
                border: 1px solid #333;
                border-radius: 8px;
                color: #fff;
              "
            >
              <option value="2025">2025ÎÖÑ</option>
              <option value="2026">2026ÎÖÑ</option>
            </select>
            <select
              id="adminAttMonth"
              onchange="loadAdminAttendance()"
              style="
                padding: 10px 15px;
                background: #222;
                border: 1px solid #333;
                border-radius: 8px;
                color: #fff;
              "
            >
              <option value="1">1Ïõî</option>
              <option value="2">2Ïõî</option>
              <option value="3">3Ïõî</option>
              <option value="4">4Ïõî</option>
              <option value="5">5Ïõî</option>
              <option value="6">6Ïõî</option>
              <option value="7">7Ïõî</option>
              <option value="8">8Ïõî</option>
              <option value="9">9Ïõî</option>
              <option value="10">10Ïõî</option>
              <option value="11">11Ïõî</option>
              <option value="12">12Ïõî</option>
            </select>
          </div>

          <div id="adminAttendanceList">
            <div style="text-align: center; padding: 40px; color: #666">
              ÏßÅÏõêÏùÑ ÏÑ†ÌÉùÌïòÏÑ∏Ïöî
            </div>
          </div>
        </div>
      </section>
    </main>

    <!-- Î°úÎî© Ïò§Î≤ÑÎ†àÏù¥ -->
    <div class="loading-overlay" id="loadingOverlay">
      <div class="spinner"></div>
      <div class="loading-text">Î∂ÑÎ•ò Ï§ë...</div>
      <div class="loading-subtext">Ïû†ÏãúÎßå Í∏∞Îã§Î†§Ï£ºÏÑ∏Ïöî</div>
    </div>

    <!-- Í≤∞Í≥º Î™®Îã¨ -->
    <div class="modal-overlay" id="resultModal">
      <div class="modal">
        <div class="modal-header">
          <div class="modal-icon">‚úÖ</div>
          <div class="modal-title">Î∂ÑÎ•ò ÏôÑÎ£å!</div>
          <div class="modal-subtitle" id="modalSubtitle"></div>
          <div
            class="modal-subtitle"
            id="starFilterMessage"
            style="color: #ffd700; margin-top: 5px; display: none"
          ></div>
        </div>

        <div class="stats-grid">
          <div class="stat-card">
            <div class="stat-value" id="statTotal">0</div>
            <div class="stat-label">Ï†ÑÏ≤¥ Ï£ºÎ¨∏</div>
          </div>
          <div class="stat-card">
            <div class="stat-value" id="statSuccess">0</div>
            <div class="stat-label">Î∂ÑÎ•ò ÏÑ±Í≥µ</div>
          </div>
          <div class="stat-card">
            <div class="stat-value warning" id="statFailed">0</div>
            <div class="stat-label">Î∂ÑÎ•ò Ïã§Ìå®</div>
          </div>
        </div>

        <div class="accuracy-bar">
          <div class="accuracy-header">
            <span class="accuracy-label">Î∂ÑÎ•ò Ï†ïÌôïÎèÑ</span>
            <span class="accuracy-value" id="accuracyValue">0%</span>
          </div>
          <div class="progress-bar">
            <div
              class="progress-fill"
              id="progressFill"
              style="width: 0%"
            ></div>
          </div>
        </div>

        <div class="modal-actions">
          <button class="btn btn-primary" id="modalDownloadBtn">
            üìÅ Í≤∞Í≥º Îã§Ïö¥Î°úÎìú
          </button>
          <button class="btn btn-outline" id="modalCloseBtn">Îã´Í∏∞</button>
        </div>
      </div>
    </div>

    <!-- ÌÜ†Ïä§Ìä∏ -->
    <div class="toast" id="toast">
      <span id="toastIcon">‚úÖ</span>
      <span id="toastMessage"></span>
    </div>

    <!-- Î™®Î∞îÏùº ÌïòÎã® ÎÑ§ÎπÑÍ≤åÏù¥ÏÖò -->
    <nav class="mobile-nav" id="mobileNav" style="display: none">
      <a class="mobile-nav-item active" data-page="home">
        <span class="mobile-nav-icon">üè†</span>
        <span>Ìôà</span>
      </a>
      <a class="mobile-nav-item" data-page="margin">
        <span class="mobile-nav-icon">üìä</span>
        <span>ÏõêÍ∞ÄÌëú</span>
      </a>
      <a class="mobile-nav-item" data-page="calculator">
        <span class="mobile-nav-icon">üßÆ</span>
        <span>Í≥ÑÏÇ∞Í∏∞</span>
      </a>
      <a class="mobile-nav-item" data-page="classify">
        <span class="mobile-nav-icon">üìã</span>
        <span>ÏÜ°Ïû•</span>
      </a>
      <a class="mobile-nav-item" data-page="starfilter">
        <span class="mobile-nav-icon">‚≠ê</span>
        <span>ÌïÑÌÑ∞</span>
      </a>
      <a class="mobile-nav-item" data-page="employees">
        <span class="mobile-nav-icon">üë•</span>
        <span>ÏßÅÏõê</span>
      </a>
      <a class="mobile-nav-item" data-page="admin-attendance">
        <span class="mobile-nav-icon">üìÖ</span>
        <span>Ï∂úÌá¥Í∑º</span>
      </a>
    </nav>

    <script>
      // ÏÉÅÌÉú Í¥ÄÎ¶¨
      let currentResultId = null;
      let currentStats = null;
      let selectedFile = null;
      let marginData = [];
      let dbConnected = false; // DB Ïó∞Í≤∞ ÏÉÅÌÉú

      // DOM ÏöîÏÜå
      const loadingOverlay = document.getElementById("loadingOverlay");
      const resultModal = document.getElementById("resultModal");
      const toast = document.getElementById("toast");

      // Ï¥àÍ∏∞Ìôî
      document.addEventListener("DOMContentLoaded", () => {
        checkDbStatus(); // DB ÏÉÅÌÉú Î®ºÏ†Ä ÌôïÏù∏
        loadSettings();
        setupNavigation();
        setupTabs();
        setupUploadAreas();
        setupButtons();
        setupMarginSearch();
        setupUserProfile();
        setupCalculator();
        checkMobile();
        window.addEventListener("resize", checkMobile);

        // Í¥ÄÎ¶¨ÏûêÏù∏ Í≤ΩÏö∞ ÏàòÏ†ï ÏöîÏ≤≠ Î°úÎìú
        loadEditRequests();
      });

      // DB Ïó∞Í≤∞ ÏÉÅÌÉú ÌôïÏù∏
      async function checkDbStatus() {
        try {
          const response = await fetch("/api/db-status");
          const data = await response.json();
          dbConnected = data.db_connected;

          // DB Ïó∞Í≤∞ Ïãú CRUD Î≤ÑÌäº ÌëúÏãú
          if (dbConnected) {
            const addMarginBtn = document.getElementById("addMarginBtn");
            if (addMarginBtn) addMarginBtn.style.display = "block";
          }

          console.log("DB Ïó∞Í≤∞ ÏÉÅÌÉú:", dbConnected ? "Ïó∞Í≤∞Îê®" : "ÎØ∏Ïó∞Í≤∞");
        } catch (error) {
          console.log("DB ÏÉÅÌÉú ÌôïÏù∏ Ïã§Ìå® - JSON Î™®ÎìúÎ°ú ÏûëÎèô");
          dbConnected = false;
        }
      }

      // Ïú†Ï†Ä ÌîÑÎ°úÌïÑ ÎìúÎ°≠Îã§Ïö¥ ÏÑ§Ï†ï
      function setupUserProfile() {
        const userBtn = document.getElementById("userBtn");
        const userDropdown = document.getElementById("userDropdown");

        if (userBtn && userDropdown) {
          userBtn.addEventListener("click", (e) => {
            e.stopPropagation();
            userDropdown.classList.toggle("show");
          });

          // Ïô∏Î∂Ä ÌÅ¥Î¶≠ Ïãú Îã´Í∏∞
          document.addEventListener("click", () => {
            userDropdown.classList.remove("show");
          });
        }
      }

      // Î™®Î∞îÏùº Ï≤¥ÌÅ¨
      function checkMobile() {
        const isMobile = window.innerWidth <= 768;
        const mobileNav = document.getElementById("mobileNav");
        if (mobileNav) {
          mobileNav.style.display = isMobile ? "flex" : "none";
        }
      }

      // ÏõêÍ∞Ä ÎßàÏßÑÌëú Îç∞Ïù¥ÌÑ∞ Î°úÎìú
      async function loadMarginData(search = "") {
        const container = document.getElementById("marginTableContainer");
        container.innerHTML =
          '<div class="loading-data">Îç∞Ïù¥ÌÑ∞ Î°úÎî©Ï§ë...</div>';

        try {
          const url = search
            ? `/api/margin?search=${encodeURIComponent(search)}`
            : "/api/margin";
          const response = await fetch(url);
          const result = await response.json();

          marginData = result.data;
          document.getElementById(
            "resultCount"
          ).textContent = `Ï¥ù ${result.total}Í∞ú ÏÉÅÌíà`;

          renderMarginTable(marginData);
        } catch (error) {
          console.error("ÏõêÍ∞Ä ÎßàÏßÑÌëú Î°úÎìú Ïò§Î•ò:", error);
          container.innerHTML =
            '<div class="loading-data">Îç∞Ïù¥ÌÑ∞ Î°úÎìú Ïã§Ìå®</div>';
        }
      }

      // ÏõêÍ∞Ä ÎßàÏßÑÌëú Î†åÎçîÎßÅ
      function renderMarginTable(data) {
        const container = document.getElementById("marginTableContainer");

        if (data.length === 0) {
          container.innerHTML = `
                    <div class="no-results">
                        <div class="no-results-icon">üîç</div>
                        <div>Í≤ÄÏÉâ Í≤∞Í≥ºÍ∞Ä ÏóÜÏäµÎãàÎã§</div>
                    </div>
                `;
          return;
        }

        // ÌÖåÏù¥Î∏î Î∑∞ (Îç∞Ïä§ÌÅ¨ÌÜ±)
        let tableHtml = `
                <div class="table-wrapper">
                    <table class="margin-table">
                        <thead>
                            <tr>
                                <th class="col-name">ÏÉÅÌíàÎ™Ö</th>
                                <th class="col-num">Ïù∏ÏÉÅÏ†Ñ ÏÉÅÌíàÍ∞Ä</th>
                                <th class="col-num">Ïù∏ÏÉÅÌõÑ ÏÉÅÌíàÍ∞Ä</th>
                                <th class="col-num">Î¨ºÎüâÏßÄÏõê</th>
                                <th class="col-num">ÌîÑÎ°úÎ™®ÏÖòÌï†Ïù∏Î•†</th>
                                <th class="col-num">Ïû•Î†§Í∏àÎ•†</th>
                                <th class="col-num">Î∞∞ÏÜ°ÎπÑ</th>
                                <th class="col-num">Î∞ïÏä§ÎπÑ</th>
                                <th class="col-num">Ïù∏ÏÉÅÏ†Ñ Ï¥ù ÏõêÍ∞Ä</th>
                                <th class="col-num">Ïù∏ÏÉÅÌõÑ Ï¥ù ÏõêÍ∞Ä</th>
                                <th class="col-center">Ïù∏ÏÉÅÏ†Ñ Ïû¨Í≥†</th>
                                <th class="col-center">1Î∞ïÏä§ ÏµúÎåÄ ÏàòÎüâ</th>
                                <th>Í∏∞ÌÉÄÏÇ¨Ìï≠</th>
                                ${
                                  dbConnected
                                    ? '<th class="col-center">Í¥ÄÎ¶¨</th>'
                                    : ""
                                }
                            </tr>
                        </thead>
                        <tbody>
            `;

        data.forEach((item) => {
          const hasStock = item["Ïù∏ÏÉÅÏ†Ñ Ïû¨Í≥†"] === "o";
          const stockClass = hasStock ? "stock-yes" : "stock-no";
          const stockText = hasStock ? "O" : "X";

          // Ïû¨Í≥† Ïú†Î¨¥Ïóê Îî∞Îùº ÌïòÏù¥ÎùºÏù¥Ìä∏ Í≤∞Ï†ï
          const preHighlight = hasStock ? "highlight" : "";
          const postHighlight = hasStock ? "" : "highlight";

          tableHtml += `
                    <tr>
                        <td class="col-name">${item["ÏÉÅÌíàÎ™Ö"]}</td>
                        <td class="col-num ${preHighlight}">${formatNumber(
            item["Ïù∏ÏÉÅÏ†Ñ ÏÉÅÌíàÍ∞Ä"]
          )}</td>
                        <td class="col-num ${postHighlight}">${formatNumber(
            item["Ïù∏ÏÉÅÌõÑ ÏÉÅÌíàÍ∞Ä"]
          )}</td>
                        <td class="col-num">${item["Î¨ºÎüâÏßÄÏõê"]}</td>
                        <td class="col-num">${formatPercent(
                          item["ÌîÑÎ°úÎ™®ÏÖòÌï†Ïù∏Î•†"]
                        )}</td>
                        <td class="col-num">${formatPercent(
                          item["Ïû•Î†§Í∏àÎ•†"]
                        )}</td>
                        <td class="col-num">${formatNumber(item["Î∞∞ÏÜ°ÎπÑ"])}</td>
                        <td class="col-num">${formatNumber(item["Î∞ïÏä§ÎπÑ"])}</td>
                        <td class="col-num ${preHighlight}">${formatNumber(
            item["Ïù∏ÏÉÅÏ†Ñ Ï¥ù ÏõêÍ∞Ä"]
          )}</td>
                        <td class="col-num ${postHighlight}">${formatNumber(
            item["Ïù∏ÏÉÅÌõÑ Ï¥ù ÏõêÍ∞Ä"]
          )}</td>
                        <td class="col-center ${stockClass}">${stockText}</td>
                        <td class="col-center">${
                          item["1Î∞ïÏä§ ÏµúÎåÄ ÏàòÎüâ"] || "-"
                        }</td>
                        <td>${item["Í∏∞ÌÉÄÏÇ¨Ìï≠"] || "-"}</td>
                        ${
                          dbConnected && item.id
                            ? `
                        <td class="col-center">
                          <button onclick='showEditMarginModal(${JSON.stringify(
                            item
                          )})' style="padding: 4px 8px; background: #333; border: none; border-radius: 4px; color: #fff; cursor: pointer; margin-right: 4px;">‚úèÔ∏è</button>
                          <button onclick="deleteMarginProduct(${
                            item.id
                          })" style="padding: 4px 8px; background: #ff4444; border: none; border-radius: 4px; color: #fff; cursor: pointer;">üóëÔ∏è</button>
                        </td>
                        `
                            : dbConnected
                            ? '<td class="col-center">-</td>'
                            : ""
                        }
                    </tr>
                `;
        });

        tableHtml += "</tbody></table></div>";

        // Ïπ¥Îìú Î∑∞ (Î™®Î∞îÏùº)
        let cardsHtml = '<div class="margin-cards">';

        data.forEach((item) => {
          const hasStock = item["Ïù∏ÏÉÅÏ†Ñ Ïû¨Í≥†"] === "o";
          const stockClass = hasStock ? "yes" : "no";
          const stockText = hasStock ? "Ïû¨Í≥†ÏûàÏùå" : "Ïû¨Í≥†ÏóÜÏùå";

          // Ïû¨Í≥† Ïú†Î¨¥Ïóê Îî∞Îùº ÌïòÏù¥ÎùºÏù¥Ìä∏ Í≤∞Ï†ï
          const preHighlight = hasStock ? "highlight" : "";
          const postHighlight = hasStock ? "" : "highlight";

          cardsHtml += `
                    <div class="margin-card">
                        <div class="margin-card-header">
                            <div class="margin-card-name">${
                              item["ÏÉÅÌíàÎ™Ö"]
                            }</div>
                            <span class="margin-card-stock ${stockClass}">${stockText}</span>
                        </div>
                        <div class="margin-card-grid">
                            <div class="margin-card-item">
                                <span class="margin-card-label">Ïù∏ÏÉÅÏ†Ñ ÏÉÅÌíàÍ∞Ä</span>
                                <span class="margin-card-value ${preHighlight}">${formatNumber(
            item["Ïù∏ÏÉÅÏ†Ñ ÏÉÅÌíàÍ∞Ä"]
          )}Ïõê</span>
                            </div>
                            <div class="margin-card-item">
                                <span class="margin-card-label">Ïù∏ÏÉÅÌõÑ ÏÉÅÌíàÍ∞Ä</span>
                                <span class="margin-card-value ${postHighlight}">${formatNumber(
            item["Ïù∏ÏÉÅÌõÑ ÏÉÅÌíàÍ∞Ä"]
          )}Ïõê</span>
                            </div>
                            <div class="margin-card-item">
                                <span class="margin-card-label">Ïù∏ÏÉÅÏ†Ñ Ï¥ù ÏõêÍ∞Ä</span>
                                <span class="margin-card-value ${preHighlight}">${formatNumber(
            item["Ïù∏ÏÉÅÏ†Ñ Ï¥ù ÏõêÍ∞Ä"]
          )}Ïõê</span>
                            </div>
                            <div class="margin-card-item">
                                <span class="margin-card-label">Ïù∏ÏÉÅÌõÑ Ï¥ù ÏõêÍ∞Ä</span>
                                <span class="margin-card-value ${postHighlight}">${formatNumber(
            item["Ïù∏ÏÉÅÌõÑ Ï¥ù ÏõêÍ∞Ä"]
          )}Ïõê</span>
                            </div>
                        </div>
                        <div class="margin-card-divider"></div>
                        <div class="margin-card-grid">
                            <div class="margin-card-item">
                                <span class="margin-card-label">Î¨ºÎüâÏßÄÏõê</span>
                                <span class="margin-card-value">${
                                  item["Î¨ºÎüâÏßÄÏõê"]
                                }</span>
                            </div>
                            <div class="margin-card-item">
                                <span class="margin-card-label">Ïû•Î†§Í∏àÎ•†</span>
                                <span class="margin-card-value">${formatPercent(
                                  item["Ïû•Î†§Í∏àÎ•†"]
                                )}</span>
                            </div>
                            <div class="margin-card-item">
                                <span class="margin-card-label">Î∞∞ÏÜ°ÎπÑ</span>
                                <span class="margin-card-value">${formatNumber(
                                  item["Î∞∞ÏÜ°ÎπÑ"]
                                )}Ïõê</span>
                            </div>
                            <div class="margin-card-item">
                                <span class="margin-card-label">1Î∞ïÏä§ ÏµúÎåÄ ÏàòÎüâ</span>
                                <span class="margin-card-value">${
                                  item["1Î∞ïÏä§ ÏµúÎåÄ ÏàòÎüâ"] || "-"
                                }</span>
                            </div>
                        </div>
                        ${
                          item["Í∏∞ÌÉÄÏÇ¨Ìï≠"]
                            ? `<div class="margin-card-note">üìù ${item["Í∏∞ÌÉÄÏÇ¨Ìï≠"]}</div>`
                            : ""
                        }
                    </div>
                `;
        });

        cardsHtml += "</div>";

        container.innerHTML = tableHtml + cardsHtml;
      }

      // Ïà´Ïûê Ìè¨Îß∑
      function formatNumber(num) {
        if (num === null || num === undefined || num === "") return "-";
        return Math.round(num).toLocaleString();
      }

      // ÌçºÏÑºÌä∏ Ìè¨Îß∑
      function formatPercent(num) {
        if (num === null || num === undefined || num === "" || num === 0)
          return "-";
        return (num * 100).toFixed(1) + "%";
      }

      // Í≤ÄÏÉâ ÏÑ§Ï†ï
      function setupMarginSearch() {
        const searchInput = document.getElementById("marginSearch");
        const clearBtn = document.getElementById("searchClear");
        let debounceTimer;

        if (searchInput) {
          searchInput.addEventListener("input", (e) => {
            const value = e.target.value;
            clearBtn.style.display = value ? "block" : "none";

            clearTimeout(debounceTimer);
            debounceTimer = setTimeout(() => {
              loadMarginData(value);
            }, 300);
          });
        }

        if (clearBtn) {
          clearBtn.addEventListener("click", () => {
            searchInput.value = "";
            clearBtn.style.display = "none";
            loadMarginData();
          });
        }
      }

      // ÏÑ§Ï†ï Î°úÎìú
      async function loadSettings() {
        try {
          const response = await fetch("/settings");
          const data = await response.json();

          if (data.status === "loaded") {
            document.getElementById(
              "settingsInfo"
            ).textContent = `${data.workers.length}Î™ÖÏùò Îã¥ÎãπÏûê, ${data.total_products}Í∞ú ÏÉÅÌíà Í∑úÏπô`;

            // Îã¥ÎãπÏûê Î™©Î°ùÏùÄ ÏÉà APIÎ°ú Î°úÎìú
            loadWorkers();
          } else {
            document.getElementById("settingsInfo").textContent =
              "ÏÑ§Ï†ï Î°úÎìú Ïã§Ìå®";
          }
        } catch (error) {
          console.error("ÏÑ§Ï†ï Î°úÎìú Ïò§Î•ò:", error);
          document.getElementById("settingsInfo").textContent =
            "ÏÑ§Ï†ï Î°úÎìú Ïò§Î•ò";
        }
      }

      // Îã¥ÎãπÏûê Î™©Î°ù Î°úÎìú (ÏÉà API)
      async function loadWorkers() {
        try {
          const response = await fetch("/api/workers");
          const data = await response.json();
          renderWorkersList(data.data, data.db_connected);
        } catch (error) {
          console.error("Îã¥ÎãπÏûê Î°úÎìú Ïò§Î•ò:", error);
          // Ìè¥Î∞±: Í∏∞Ï°¥ Î∞©Ïãù
          try {
            const response = await fetch("/settings");
            const data = await response.json();
            if (data.status === "loaded") {
              renderWorkersListLegacy(data.workers);
            }
          } catch (e) {
            console.error("Ìè¥Î∞±ÎèÑ Ïã§Ìå®:", e);
          }
        }
      }

      // Îã¥ÎãπÏûê Î™©Î°ù Î†åÎçîÎßÅ (ÏÉà Î≤ÑÏ†Ñ - DB ÏßÄÏõê)
      function renderWorkersList(workers, canEdit) {
        const container = document.getElementById("workersList");

        if (!workers || workers.length === 0) {
          container.innerHTML =
            '<div style="text-align: center; padding: 40px; color: #666;">Îã¥ÎãπÏûê Îç∞Ïù¥ÌÑ∞Í∞Ä ÏóÜÏäµÎãàÎã§</div>';
          return;
        }

        container.innerHTML = workers
          .map(
            (worker) => `
                <div class="worker-item" style="cursor: ${
                  canEdit ? "pointer" : "default"
                };" ${
              canEdit
                ? `onclick="openWorkerProducts(${worker.id}, '${
                    worker.name
                  }', '${worker.icon || "üìã"}')"`
                : ""
            }>
                    <span class="worker-item-icon">${worker.icon || "üìã"}</span>
                    <div class="worker-item-info">
                        <div class="worker-item-name">${worker.name}</div>
                        <div class="worker-item-desc">${
                          worker.description || ""
                        }</div>
                    </div>
                    <div style="display: flex; align-items: center; gap: 8px;">
                      <span style="color: #666; font-size: 13px;">${
                        worker.product_count || 0
                      }Í∞ú Í∑úÏπô</span>
                      ${canEdit ? '<span style="color: #00ff88;">‚ñ∂</span>' : ""}
                    </div>
                </div>
            `
          )
          .join("");
      }

      // Îã¥ÎãπÏûê Î™©Î°ù Î†åÎçîÎßÅ (Î†àÍ±∞Ïãú - ÌïòÏúÑ Ìò∏Ìôò)
      function renderWorkersListLegacy(workers) {
        const container = document.getElementById("workersList");
        const icons = {
          ÏÜ°Í≥ºÏû•Îãò: "üçß",
          ÏòÅÏû¨Ïî®: "üçØ",
          Ìö®ÏÉÅ: "üçú",
          Í∞ïÎØºÏî®: "üçú",
          Î∂ÄÎ™®Îãò: "‚òï",
          Ìï©Î∞∞ÏÜ°: "üì¶",
          Î≥µÏàòÏ£ºÎ¨∏: "üìã",
          Î∂ÑÎ•òÏã§Ìå®: "‚ùì",
        };
        const descriptions = {
          ÏÜ°Í≥ºÏû•Îãò: "Ìå•ÎπôÏàòÏû¨Î£å Î∞è ÌäπÏ†ï ÏÉÅÌíà Îã¥Îãπ",
          ÏòÅÏû¨Ïî®: "ÎØ∏ÏóêÎ°úÌôîÏù¥Î∞î, ÍøÄÏ∞®, ÌååÏö∞ÏπòÏùåÎ£å Îã¥Îãπ",
          Ìö®ÏÉÅ: "Î∞±Ï†ú ÏåÄÍµ≠Ïàò, Îñ°Íµ≠ Îã¥Îãπ",
          Í∞ïÎØºÏî®: "Î∞±Ï†ú Î∏åÎûúÎìú Î™®Îì† ÏÉÅÌíà Îã¥Îãπ",
          Î∂ÄÎ™®Îãò: "ÏüàÎéÖ, Î∂ÄÍµ≠, Î¶∞Ï†Ä, Ïπ¥ÌéòÏû¨Î£å Îã¥Îãπ",
          Ìï©Î∞∞ÏÜ°: "Ìïú Ï£ºÎ¨∏Î≤àÌò∏Ïóê Ïó¨Îü¨ Îã§Î•∏ ÏÉÅÌíà",
          Î≥µÏàòÏ£ºÎ¨∏: "Ìïú ÏÉÅÌíàÏùÑ 2Í∞ú Ïù¥ÏÉÅ Ï£ºÎ¨∏",
          Î∂ÑÎ•òÏã§Ìå®: "Îß§Ïπ≠ÎêòÏßÄ ÏïäÏùÄ ÏÉÅÌíà (ÏàòÎèô Í≤ÄÌÜ† ÌïÑÏöî)",
        };

        container.innerHTML = workers
          .map(
            (worker) => `
                <div class="worker-item">
                    <span class="worker-item-icon">${
                      icons[worker] || "üìã"
                    }</span>
                    <div class="worker-item-info">
                        <div class="worker-item-name">${worker}</div>
                        <div class="worker-item-desc">${
                          descriptions[worker] || ""
                        }</div>
                    </div>
                </div>
            `
          )
          .join("");
      }

      // ==================== Îã¥ÎãπÏûê ÏÉÅÌíà Í∑úÏπô CRUD ====================
      let currentWorkerId = null;
      let currentWorkerName = "";
      let editingProductId = null;

      async function openWorkerProducts(workerId, workerName, icon) {
        if (!dbConnected) {
          showToast("info", "DB Ïó∞Í≤∞ ÏãúÏóêÎßå ÏàòÏ†ï Í∞ÄÎä•Ìï©ÎãàÎã§");
          return;
        }

        currentWorkerId = workerId;
        currentWorkerName = workerName;

        document.getElementById("workerModalIcon").textContent = icon;
        document.getElementById("workerModalTitle").textContent = workerName;
        document.getElementById("workerModalSubtitle").textContent =
          "ÏÉÅÌíà Í∑úÏπô Í¥ÄÎ¶¨";
        document.getElementById("workerAddBtnArea").style.display = "block";

        await loadWorkerProducts(workerId);
        document.getElementById("workerProductsModal").classList.add("show");
      }

      async function loadWorkerProducts(workerId) {
        const container = document.getElementById("workerProductsList");
        container.innerHTML =
          '<div style="text-align: center; padding: 20px; color: #666;">Î°úÎî©Ï§ë...</div>';

        try {
          const response = await fetch(`/api/workers/${workerId}/products`);
          const data = await response.json();

          if (!data.data || data.data.length === 0) {
            container.innerHTML =
              '<div style="text-align: center; padding: 40px; color: #666;">Îì±Î°ùÎêú ÏÉÅÌíà Í∑úÏπôÏù¥ ÏóÜÏäµÎãàÎã§</div>';
            return;
          }

          const canEdit = data.db_connected !== false;

          container.innerHTML = data.data
            .map(
              (product) => `
            <div class="worker-product-item" style="display: flex; align-items: center; padding: 12px; background: #222; border-radius: 8px; margin-bottom: 8px;">
              <div style="flex: 1;">
                <div style="color: #00ff88; font-size: 13px; margin-bottom: 4px;">${
                  product.brand || "(Î∏åÎûúÎìú ÏóÜÏùå)"
                }</div>
                <div style="font-size: 14px;">${product.product_name}</div>
                <div style="color: #666; font-size: 12px; margin-top: 2px;">ÏòµÏÖò: ${
                  product.order_option
                }</div>
              </div>
              ${
                canEdit
                  ? `
              <div style="display: flex; gap: 8px;">
                <button onclick="editWorkerProduct(${product.id}, '${escapeHtml(
                      product.brand || ""
                    )}', '${escapeHtml(product.product_name)}', '${escapeHtml(
                      product.order_option
                    )}')" style="padding: 6px 12px; background: #333; border: none; border-radius: 4px; color: #fff; cursor: pointer;">‚úèÔ∏è</button>
                <button onclick="deleteWorkerProduct(${
                  product.id
                })" style="padding: 6px 12px; background: #ff4444; border: none; border-radius: 4px; color: #fff; cursor: pointer;">üóëÔ∏è</button>
              </div>
              `
                  : ""
              }
            </div>
          `
            )
            .join("");
        } catch (error) {
          console.error("ÏÉÅÌíà Í∑úÏπô Î°úÎìú Ïò§Î•ò:", error);
          container.innerHTML =
            '<div style="text-align: center; padding: 20px; color: #ff6b6b;">Î°úÎìú Ïã§Ìå®</div>';
        }
      }

      function escapeHtml(str) {
        if (!str) return "";
        return str.replace(/'/g, "\\'").replace(/"/g, '\\"');
      }

      function showAddProductForm() {
        document.getElementById("addProductForm").style.display = "block";
        document.getElementById("newBrand").value = "";
        document.getElementById("newProductName").value = "";
        document.getElementById("newOrderOption").value = "";
        document.getElementById("saveProductBtn").textContent = "Ï†ÄÏû•";
        document.getElementById("saveProductBtn").onclick = saveNewProduct;
        editingProductId = null;
      }

      function hideAddProductForm() {
        document.getElementById("addProductForm").style.display = "none";
        editingProductId = null;
      }

      async function saveNewProduct() {
        const brand = document.getElementById("newBrand").value.trim();
        const productName = document
          .getElementById("newProductName")
          .value.trim();
        const orderOption =
          document.getElementById("newOrderOption").value.trim() || "All";

        if (!productName) {
          showToast("error", "ÏÉÅÌíàÎ™ÖÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî");
          return;
        }

        try {
          const response = await fetch(
            `/api/workers/${currentWorkerId}/products`,
            {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify({
                brand,
                product_name: productName,
                order_option: orderOption,
              }),
            }
          );

          const result = await response.json();

          if (result.success) {
            showToast("success", "ÏÉÅÌíà Í∑úÏπôÏù¥ Ï∂îÍ∞ÄÎêòÏóàÏäµÎãàÎã§");
            hideAddProductForm();
            loadWorkerProducts(currentWorkerId);
            loadSettings();
          } else {
            showToast("error", result.error || "Ï∂îÍ∞Ä Ïã§Ìå®");
          }
        } catch (error) {
          showToast("error", "ÏÑúÎ≤Ñ Ïò§Î•ò");
        }
      }

      function editWorkerProduct(productId, brand, productName, orderOption) {
        editingProductId = productId;
        document.getElementById("addProductForm").style.display = "block";
        document.getElementById("newBrand").value = brand || "";
        document.getElementById("newProductName").value = productName || "";
        document.getElementById("newOrderOption").value = orderOption || "All";
        document.getElementById("saveProductBtn").textContent = "ÏàòÏ†ï";
        document.getElementById("saveProductBtn").onclick = updateWorkerProduct;
      }

      async function updateWorkerProduct() {
        const brand = document.getElementById("newBrand").value.trim();
        const productName = document
          .getElementById("newProductName")
          .value.trim();
        const orderOption =
          document.getElementById("newOrderOption").value.trim() || "All";

        if (!productName) {
          showToast("error", "ÏÉÅÌíàÎ™ÖÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî");
          return;
        }

        try {
          const response = await fetch(
            `/api/workers/${currentWorkerId}/products/${editingProductId}`,
            {
              method: "PUT",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify({
                brand,
                product_name: productName,
                order_option: orderOption,
              }),
            }
          );

          const result = await response.json();

          if (result.success) {
            showToast("success", "ÏÉÅÌíà Í∑úÏπôÏù¥ ÏàòÏ†ïÎêòÏóàÏäµÎãàÎã§");
            hideAddProductForm();
            loadWorkerProducts(currentWorkerId);
          } else {
            showToast("error", result.error || "ÏàòÏ†ï Ïã§Ìå®");
          }
        } catch (error) {
          showToast("error", "ÏÑúÎ≤Ñ Ïò§Î•ò");
        }
      }

      async function deleteWorkerProduct(productId) {
        if (!confirm("Ïù¥ ÏÉÅÌíà Í∑úÏπôÏùÑ ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?")) return;

        try {
          const response = await fetch(
            `/api/workers/${currentWorkerId}/products/${productId}`,
            {
              method: "DELETE",
            }
          );

          const result = await response.json();

          if (result.success) {
            showToast("success", "ÏÇ≠Ï†úÎêòÏóàÏäµÎãàÎã§");
            loadWorkerProducts(currentWorkerId);
            loadSettings();
          } else {
            showToast("error", result.error || "ÏÇ≠Ï†ú Ïã§Ìå®");
          }
        } catch (error) {
          showToast("error", "ÏÑúÎ≤Ñ Ïò§Î•ò");
        }
      }

      function closeWorkerProductsModal() {
        document.getElementById("workerProductsModal").classList.remove("show");
        hideAddProductForm();
      }

      // ==================== ÏõêÍ∞Ä ÎßàÏßÑÌëú CRUD ====================

      function showAddMarginModal() {
        if (!dbConnected) {
          showToast("info", "DB Ïó∞Í≤∞ ÏãúÏóêÎßå Ï∂îÍ∞Ä Í∞ÄÎä•Ìï©ÎãàÎã§");
          return;
        }

        document.getElementById("marginModalTitle").textContent = "ÏÉÅÌíà Ï∂îÍ∞Ä";
        document.getElementById("marginEditId").value = "";

        // Ìèº Ï¥àÍ∏∞Ìôî
        document.getElementById("marginName").value = "";
        document.getElementById("marginPrePrice").value = "";
        document.getElementById("marginPostPrice").value = "";
        document.getElementById("marginSupply").value = "1";
        document.getElementById("marginPromo").value = "0";
        document.getElementById("marginIncentive").value = "0";
        document.getElementById("marginShipping").value = "0";
        document.getElementById("marginBox").value = "0";
        document.getElementById("marginPreCost").value = "";
        document.getElementById("marginPostCost").value = "";
        document.getElementById("marginStock").value = "";
        document.getElementById("marginBoxQty").value = "";
        document.getElementById("marginNote").value = "";

        document.getElementById("marginProductModal").classList.add("show");
      }

      function showEditMarginModal(item) {
        if (!dbConnected) {
          showToast("info", "DB Ïó∞Í≤∞ ÏãúÏóêÎßå ÏàòÏ†ï Í∞ÄÎä•Ìï©ÎãàÎã§");
          return;
        }

        document.getElementById("marginModalTitle").textContent = "ÏÉÅÌíà ÏàòÏ†ï";
        document.getElementById("marginEditId").value = item.id;

        document.getElementById("marginName").value = item["ÏÉÅÌíàÎ™Ö"] || "";
        document.getElementById("marginPrePrice").value =
          item["Ïù∏ÏÉÅÏ†Ñ ÏÉÅÌíàÍ∞Ä"] || "";
        document.getElementById("marginPostPrice").value =
          item["Ïù∏ÏÉÅÌõÑ ÏÉÅÌíàÍ∞Ä"] || "";
        document.getElementById("marginSupply").value = item["Î¨ºÎüâÏßÄÏõê"] || 1;
        document.getElementById("marginPromo").value =
          item["ÌîÑÎ°úÎ™®ÏÖòÌï†Ïù∏Î•†"] || 0;
        document.getElementById("marginIncentive").value =
          item["Ïû•Î†§Í∏àÎ•†"] || 0;
        document.getElementById("marginShipping").value = item["Î∞∞ÏÜ°ÎπÑ"] || 0;
        document.getElementById("marginBox").value = item["Î∞ïÏä§ÎπÑ"] || 0;
        document.getElementById("marginPreCost").value =
          item["Ïù∏ÏÉÅÏ†Ñ Ï¥ù ÏõêÍ∞Ä"] || "";
        document.getElementById("marginPostCost").value =
          item["Ïù∏ÏÉÅÌõÑ Ï¥ù ÏõêÍ∞Ä"] || "";
        document.getElementById("marginStock").value =
          item["Ïù∏ÏÉÅÏ†Ñ Ïû¨Í≥†"] || "";
        document.getElementById("marginBoxQty").value =
          item["1Î∞ïÏä§ ÏµúÎåÄ ÏàòÎüâ"] || "";
        document.getElementById("marginNote").value = item["Í∏∞ÌÉÄÏÇ¨Ìï≠"] || "";

        document.getElementById("marginProductModal").classList.add("show");
      }

      function closeMarginModal() {
        document.getElementById("marginProductModal").classList.remove("show");
      }

      async function saveMarginProduct() {
        const productId = document.getElementById("marginEditId").value;
        const productData = {
          ÏÉÅÌíàÎ™Ö: document.getElementById("marginName").value.trim(),
          "Ïù∏ÏÉÅÏ†Ñ ÏÉÅÌíàÍ∞Ä":
            parseFloat(document.getElementById("marginPrePrice").value) || 0,
          "Ïù∏ÏÉÅÌõÑ ÏÉÅÌíàÍ∞Ä":
            parseFloat(document.getElementById("marginPostPrice").value) || 0,
          Î¨ºÎüâÏßÄÏõê:
            parseFloat(document.getElementById("marginSupply").value) || 1,
          ÌîÑÎ°úÎ™®ÏÖòÌï†Ïù∏Î•†:
            parseFloat(document.getElementById("marginPromo").value) || 0,
          Ïû•Î†§Í∏àÎ•†:
            parseFloat(document.getElementById("marginIncentive").value) || 0,
          Î∞∞ÏÜ°ÎπÑ:
            parseFloat(document.getElementById("marginShipping").value) || 0,
          Î∞ïÏä§ÎπÑ: parseFloat(document.getElementById("marginBox").value) || 0,
          "Ïù∏ÏÉÅÏ†Ñ Ï¥ù ÏõêÍ∞Ä":
            parseFloat(document.getElementById("marginPreCost").value) || 0,
          "Ïù∏ÏÉÅÌõÑ Ï¥ù ÏõêÍ∞Ä":
            parseFloat(document.getElementById("marginPostCost").value) || 0,
          "Ïù∏ÏÉÅÏ†Ñ Ïû¨Í≥†": document.getElementById("marginStock").value,
          "1Î∞ïÏä§ ÏµúÎåÄ ÏàòÎüâ": document.getElementById("marginBoxQty").value,
          Í∏∞ÌÉÄÏÇ¨Ìï≠: document.getElementById("marginNote").value,
        };

        if (!productData["ÏÉÅÌíàÎ™Ö"]) {
          showToast("error", "ÏÉÅÌíàÎ™ÖÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî");
          return;
        }

        try {
          let response;
          if (productId) {
            response = await fetch(`/api/margin/${productId}`, {
              method: "PUT",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify(productData),
            });
          } else {
            response = await fetch("/api/margin", {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify(productData),
            });
          }

          const result = await response.json();

          if (result.success) {
            showToast(
              "success",
              productId ? "ÏàòÏ†ïÎêòÏóàÏäµÎãàÎã§" : "Ï∂îÍ∞ÄÎêòÏóàÏäµÎãàÎã§"
            );
            closeMarginModal();
            loadMarginData(document.getElementById("marginSearch").value);
          } else {
            showToast("error", result.error || "Ï†ÄÏû• Ïã§Ìå®");
          }
        } catch (error) {
          showToast("error", "ÏÑúÎ≤Ñ Ïò§Î•ò");
        }
      }

      async function deleteMarginProduct(productId) {
        if (!confirm("Ïù¥ ÏÉÅÌíàÏùÑ ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?")) return;

        try {
          const response = await fetch(`/api/margin/${productId}`, {
            method: "DELETE",
          });

          const result = await response.json();

          if (result.success) {
            showToast("success", "ÏÇ≠Ï†úÎêòÏóàÏäµÎãàÎã§");
            loadMarginData(document.getElementById("marginSearch").value);
          } else {
            showToast("error", result.error || "ÏÇ≠Ï†ú Ïã§Ìå®");
          }
        } catch (error) {
          showToast("error", "ÏÑúÎ≤Ñ Ïò§Î•ò");
        }
      }

      // ÎÑ§ÎπÑÍ≤åÏù¥ÏÖò ÏÑ§Ï†ï
      function setupNavigation() {
        // Î°úÍ≥† ÌÅ¥Î¶≠ Ïãú ÌôàÏúºÎ°ú Ïù¥Îèô
        document.getElementById("logoBtn").addEventListener("click", () => {
          navigateToPage("home");
        });

        // ÏÇ¨Ïù¥ÎìúÎ∞î ÎÑ§ÎπÑÍ≤åÏù¥ÏÖò
        document.querySelectorAll(".nav-item").forEach((item) => {
          item.addEventListener("click", () => {
            const page = item.dataset.page;
            navigateToPage(page);
          });
        });

        // Î™®Î∞îÏùº ÎÑ§ÎπÑÍ≤åÏù¥ÏÖò
        document.querySelectorAll(".mobile-nav-item").forEach((item) => {
          item.addEventListener("click", (e) => {
            e.preventDefault();
            const page = item.dataset.page;
            navigateToPage(page);
          });
        });
      }

      // ÌéòÏù¥ÏßÄ Ïù¥Îèô Ìï®Ïàò
      function navigateToPage(page) {
        // ÏÇ¨Ïù¥ÎìúÎ∞î ÌôúÏÑ±Ìôî
        document
          .querySelectorAll(".nav-item")
          .forEach((n) => n.classList.remove("active"));
        const sideNavItem = document.querySelector(
          `.nav-item[data-page="${page}"]`
        );
        if (sideNavItem) sideNavItem.classList.add("active");

        // Î™®Î∞îÏùº ÎÑ§ÎπÑÍ≤åÏù¥ÏÖò ÌôúÏÑ±Ìôî
        document
          .querySelectorAll(".mobile-nav-item")
          .forEach((n) => n.classList.remove("active"));
        const mobileNavItem = document.querySelector(
          `.mobile-nav-item[data-page="${page}"]`
        );
        if (mobileNavItem) mobileNavItem.classList.add("active");

        // ÌéòÏù¥ÏßÄ Ï†ÑÌôò
        document
          .querySelectorAll(".page")
          .forEach((p) => (p.style.display = "none"));
        document.getElementById(`page-${page}`).style.display = "block";

        // ÌéòÏù¥ÏßÄÎ≥Ñ Îç∞Ïù¥ÌÑ∞ Î°úÎìú
        if (page === "margin" && marginData.length === 0) {
          loadMarginData();
        } else if (page === "employees") {
          loadEmployees();
          loadHolidays();
          const now = new Date();
          if (document.getElementById("holidayYear")) {
            document.getElementById("holidayYear").value = now.getFullYear();
            document.getElementById("holidayMonth").value = now.getMonth() + 1;
          }
        } else if (page === "admin-attendance") {
          loadAdminAttendance();
          const now = new Date();
          if (document.getElementById("adminAttYear")) {
            document.getElementById("adminAttYear").value = now.getFullYear();
            document.getElementById("adminAttMonth").value = now.getMonth() + 1;
          }
        }
      }

      // ÌÉ≠ ÏÑ§Ï†ï
      function setupTabs() {
        document.querySelectorAll(".tab").forEach((tab) => {
          tab.addEventListener("click", () => {
            const tabId = tab.dataset.tab;

            // ÌÉ≠ ÌôúÏÑ±Ìôî
            document
              .querySelectorAll(".tab")
              .forEach((t) => t.classList.remove("active"));
            tab.classList.add("active");

            // ÌÉ≠ ÏΩòÌÖêÏ∏† Ï†ÑÌôò
            document
              .querySelectorAll(".tab-content")
              .forEach((c) => c.classList.remove("active"));
            document.getElementById(`tab-${tabId}`).classList.add("active");
          });
        });
      }

      // ÏóÖÎ°úÎìú ÏòÅÏó≠ ÏÑ§Ï†ï
      function setupUploadAreas() {
        // ÏÜ°Ïû• Î∂ÑÎ•ò ÏóÖÎ°úÎìú
        const classifyArea = document.getElementById("classifyUploadArea");
        const classifyInput = document.getElementById("classifyFileInput");

        classifyArea.addEventListener("click", () => classifyInput.click());
        classifyArea.addEventListener("dragover", handleDragOver);
        classifyArea.addEventListener("dragleave", handleDragLeave);
        classifyArea.addEventListener("drop", (e) => handleDrop(e, "classify"));
        classifyInput.addEventListener("change", (e) =>
          handleFileSelect(e, "classify")
        );

        // Ïä§ÌÉÄÎ∞∞ÏÜ° ÌïÑÌÑ∞ ÏóÖÎ°úÎìú
        const starArea = document.getElementById("starUploadArea");
        const starInput = document.getElementById("starFileInput");

        starArea.addEventListener("click", () => starInput.click());
        starArea.addEventListener("dragover", handleDragOver);
        starArea.addEventListener("dragleave", handleDragLeave);
        starArea.addEventListener("drop", (e) => handleDrop(e, "star"));
        starInput.addEventListener("change", (e) =>
          handleFileSelect(e, "star")
        );
      }

      function handleDragOver(e) {
        e.preventDefault();
        e.currentTarget.classList.add("dragover");
      }

      function handleDragLeave(e) {
        e.currentTarget.classList.remove("dragover");
      }

      function handleDrop(e, type) {
        e.preventDefault();
        e.currentTarget.classList.remove("dragover");

        const file = e.dataTransfer.files[0];
        if (file) {
          processFile(file, type);
        }
      }

      function handleFileSelect(e, type) {
        const file = e.target.files[0];
        if (file) {
          processFile(file, type);
        }
      }

      function processFile(file, type) {
        const validExts = [".xls", ".xlsx"];
        const ext = file.name
          .substring(file.name.lastIndexOf("."))
          .toLowerCase();

        if (!validExts.includes(ext)) {
          showToast("error", ".xls ÎòêÎäî .xlsx ÌååÏùºÎßå ÏóÖÎ°úÎìú Í∞ÄÎä•Ìï©ÎãàÎã§");
          return;
        }

        if (type === "classify") {
          selectedFile = file;
          document.getElementById("classifyFileName").textContent = file.name;
          document.getElementById(
            "classifyFileSize"
          ).textContent = `ÌÅ¨Í∏∞: ${formatFileSize(file.size)}`;
          document.getElementById("classifyFileInfo").classList.add("show");
          document.getElementById("classifyBtn").disabled = false;
        } else {
          document.getElementById("starFileName").textContent = file.name;
          document.getElementById(
            "starFileSize"
          ).textContent = `ÌÅ¨Í∏∞: ${formatFileSize(file.size)}`;
          document.getElementById("starFileInfo").classList.add("show");
          document.getElementById("starFilterBtn").disabled = false;
        }
      }

      function formatFileSize(bytes) {
        if (bytes < 1024) return bytes + " B";
        if (bytes < 1024 * 1024) return (bytes / 1024).toFixed(2) + " KB";
        return (bytes / (1024 * 1024)).toFixed(2) + " MB";
      }

      // Î≤ÑÌäº ÏÑ§Ï†ï
      function setupButtons() {
        // Î∂ÑÎ•ò ÏãúÏûë
        document
          .getElementById("classifyBtn")
          .addEventListener("click", startClassification);

        // Í≤∞Í≥º Îã§Ïö¥Î°úÎìú
        document
          .getElementById("downloadBtn")
          .addEventListener("click", downloadResult);
        document
          .getElementById("modalDownloadBtn")
          .addEventListener("click", downloadResult);

        // Î™®Îã¨ Îã´Í∏∞
        document
          .getElementById("modalCloseBtn")
          .addEventListener("click", () => {
            resultModal.classList.remove("show");
          });

        // Ïä§ÌÉÄÎ∞∞ÏÜ° ÌïÑÌÑ∞
        document
          .getElementById("starFilterBtn")
          .addEventListener("click", startStarFilter);
      }

      // Î∂ÑÎ•ò ÏãúÏûë
      async function startClassification() {
        if (!selectedFile) return;

        showLoading();

        try {
          const formData = new FormData();
          formData.append("file", selectedFile);

          // Ïä§ÌÉÄÎ∞∞ÏÜ° ÌïÑÌÑ∞ÎßÅ Ï≤¥ÌÅ¨Î∞ïÏä§ ÏÉÅÌÉú Ï∂îÍ∞Ä
          const filterStar = document.getElementById("starFilterCheck").checked;
          formData.append("filter_star", filterStar);

          const response = await fetch("/classify", {
            method: "POST",
            body: formData,
          });

          const result = await response.json();

          hideLoading();

          // Ïù¥ÎØ∏ ÌïÑÌÑ∞ÎßÅÎêú ÌååÏùºÏù∏ Í≤ΩÏö∞ ÌåùÏóÖ ÌëúÏãú
          if (result.error === "already_filtered") {
            alert(result.message);
            return;
          }

          if (result.success) {
            currentResultId = result.session_id;
            currentStats = result.stats;

            // Í≤∞Í≥º Î™®Îã¨ ÌëúÏãú (Ïä§ÌÉÄÎ∞∞ÏÜ° Î©îÏãúÏßÄ Ìè¨Ìï®)
            showResultModal(result.stats);

            // Î∂ÑÏÑù ÌÉ≠ ÏóÖÎç∞Ïù¥Ìä∏
            updateAnalysisTab(result.stats);

            // Îã§Ïö¥Î°úÎìú Î≤ÑÌäº ÌôúÏÑ±Ìôî
            document.getElementById("downloadBtn").disabled = false;
          } else {
            showToast("error", result.error || "Î∂ÑÎ•ò Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§");
          }
        } catch (error) {
          hideLoading();
          console.error("Î∂ÑÎ•ò Ïò§Î•ò:", error);
          showToast("error", "ÏÑúÎ≤Ñ Ïó∞Í≤∞ Ïò§Î•ò");
        }
      }

      // Í≤∞Í≥º Îã§Ïö¥Î°úÎìú
      function downloadResult() {
        if (!currentResultId) {
          showToast("error", "Îã§Ïö¥Î°úÎìúÌï† Í≤∞Í≥ºÍ∞Ä ÏóÜÏäµÎãàÎã§");
          return;
        }

        window.location.href = `/download/${currentResultId}`;
        showToast("success", "Îã§Ïö¥Î°úÎìúÍ∞Ä ÏãúÏûëÎêòÏóàÏäµÎãàÎã§");
      }

      // Ïä§ÌÉÄÎ∞∞ÏÜ° ÌïÑÌÑ∞
      async function startStarFilter() {
        const input = document.getElementById("starFileInput");
        if (!input.files[0]) return;

        showLoading();

        try {
          const formData = new FormData();
          formData.append("file", input.files[0]);

          const response = await fetch("/upload", {
            method: "POST",
            body: formData,
          });

          hideLoading();

          if (response.ok) {
            const blob = await response.blob();
            const deletedCount = response.headers.get("X-Deleted-Count");

            // Îã§Ïö¥Î°úÎìú
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement("a");
            a.href = url;
            a.download = `pa${Date.now()}.xlsx`;
            a.click();
            window.URL.revokeObjectURL(url);

            showToast(
              "success",
              `${deletedCount}Í∞úÏùò Ïä§ÌÉÄÎ∞∞ÏÜ° Ï£ºÎ¨∏Ïù¥ ÏÇ≠Ï†úÎêòÏóàÏäµÎãàÎã§`
            );
          } else {
            const error = await response.json();
            showToast("error", error.error || "Ï≤òÎ¶¨ Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§");
          }
        } catch (error) {
          hideLoading();
          console.error("ÌïÑÌÑ∞ Ïò§Î•ò:", error);
          showToast("error", "ÏÑúÎ≤Ñ Ïó∞Í≤∞ Ïò§Î•ò");
        }
      }

      // Í≤∞Í≥º Î™®Îã¨ ÌëúÏãú
      function showResultModal(stats) {
        const summary = stats.summary;

        document.getElementById("statTotal").textContent = summary.total_orders;
        document.getElementById("statSuccess").textContent =
          summary.success_count;
        document.getElementById("statFailed").textContent =
          summary.failed_count;
        document.getElementById("accuracyValue").textContent =
          summary.auto_classification_rate + "%";
        document.getElementById("progressFill").style.width =
          summary.auto_classification_rate + "%";
        document.getElementById(
          "modalSubtitle"
        ).textContent = `Ï¥ù ${summary.total_orders}Í±¥Ïùò Ï£ºÎ¨∏Ïù¥ Ï≤òÎ¶¨ÎêòÏóàÏäµÎãàÎã§`;

        // Ïä§ÌÉÄÎ∞∞ÏÜ° ÌïÑÌÑ∞ÎßÅ Î©îÏãúÏßÄ ÌëúÏãú
        const starMsgEl = document.getElementById("starFilterMessage");
        if (summary.star_filtered) {
          if (summary.star_deleted > 0) {
            starMsgEl.textContent = `‚≠ê Ï¥ù ${summary.star_deleted}Í±¥Ïùò Ïä§ÌÉÄÎ∞∞ÏÜ° Ï£ºÎ¨∏Ïù¥ Ï†úÍ±∞ÎêòÏóàÏäµÎãàÎã§`;
            starMsgEl.style.color = "#ffd700";
          } else {
            starMsgEl.textContent = `‚≠ê Îî∞Î°ú Ï†úÍ±∞Ìï† Ïä§ÌÉÄÎ∞∞ÏÜ° Ï£ºÎ¨∏Ïù¥ ÏóÜÏóàÏäµÎãàÎã§`;
            starMsgEl.style.color = "#888";
          }
          starMsgEl.style.display = "block";
        } else {
          starMsgEl.style.display = "none";
        }

        resultModal.classList.add("show");
      }

      // Î∂ÑÏÑù ÌÉ≠ ÏóÖÎç∞Ïù¥Ìä∏
      function updateAnalysisTab(stats) {
        const container = document.getElementById("analysisContent");
        const workers = stats.workers; // Ïù¥Ï†ú Î∞∞Ïó¥Î°ú ÏàúÏÑú Ïú†ÏßÄÎê®

        let html = '<div class="worker-stats">';

        for (const data of workers) {
          if (data.count > 0) {
            html += `
                        <div class="worker-card">
                            <div class="worker-header">
                                <span class="worker-icon">${
                                  data.icon || "üìã"
                                }</span>
                                <span class="worker-name">${data.name}</span>
                            </div>
                            <div class="worker-stat-row">
                                <span class="worker-label">Ï¥ù ÏÜ°Ïû•Ïàò:</span>
                                <span class="worker-value">${
                                  data.count
                                }Í±¥</span>
                            </div>
                            <div class="worker-stat-row">
                                <span class="worker-label">ÏÜ°Ïû• Î≤îÏúÑ:</span>
                                <span class="worker-range">${
                                  data.range
                                    ? data.range.replace(" ~ ", "Î≤à ~ ") + "Î≤à"
                                    : "-"
                                }</span>
                            </div>
                        </div>
                    `;
          }
        }

        html += "</div>";
        container.innerHTML = html;
      }

      // Î°úÎî© ÌëúÏãú
      function showLoading() {
        loadingOverlay.classList.add("show");
      }

      function hideLoading() {
        loadingOverlay.classList.remove("show");
      }

      // ÌÜ†Ïä§Ìä∏ ÌëúÏãú
      function showToast(type, message) {
        const toastEl = document.getElementById("toast");
        const iconEl = document.getElementById("toastIcon");
        const msgEl = document.getElementById("toastMessage");

        iconEl.textContent = type === "success" ? "‚úÖ" : "‚ùå";
        msgEl.textContent = message;

        toastEl.className = `toast show ${type}`;

        setTimeout(() => {
          toastEl.classList.remove("show");
        }, 3000);
      }

      // ==================== Ï¢ÖÌï© Í≥ÑÏÇ∞Í∏∞ ====================

      // Í≥ÑÏÇ∞Í∏∞ ÏÑ§Ï†ï
      function setupCalculator() {
        // Í≥ÑÏÇ∞Í∏∞ ÌÉ≠ Ï†ÑÌôò
        document.querySelectorAll(".calc-tab").forEach((tab) => {
          tab.addEventListener("click", () => {
            const calcType = tab.dataset.calc;

            // ÌÉ≠ ÌôúÏÑ±Ìôî
            document
              .querySelectorAll(".calc-tab")
              .forEach((t) => t.classList.remove("active"));
            tab.classList.add("active");

            // ÏΩòÌÖêÏ∏† Ï†ÑÌôò
            document
              .querySelectorAll(".calc-content")
              .forEach((c) => c.classList.remove("active"));
            document.getElementById(`calc-${calcType}`).classList.add("active");
          });
        });

        // ÎßàÏßÑÎ•† Ïä¨ÎùºÏù¥Îçî
        const slider = document.getElementById("targetMarginSlider");
        const sliderValue = document.getElementById("targetMarginValue");

        if (slider) {
          // Ïä¨ÎùºÏù¥Îçî Ï¥àÍ∏∞Í∞í ÏÑ§Ï†ï
          updateSliderBackground(slider);

          slider.addEventListener("input", () => {
            sliderValue.textContent = slider.value + "%";
            updateSliderBackground(slider);
            calculatePrice();
          });
        }

        // ÌåêÎß§Í∞Ä Ï±ÖÏ†ïÍ∏∞ ÏûÖÎ†• ÌïÑÎìú Ïù¥Î≤§Ìä∏
        ["priceCost", "priceShipping", "priceBox"].forEach((id) => {
          const input = document.getElementById(id);
          if (input) {
            input.addEventListener("input", calculatePrice);
          }
        });
      }

      // Ïä¨ÎùºÏù¥Îçî Î∞∞Í≤Ω ÏóÖÎç∞Ïù¥Ìä∏
      function updateSliderBackground(slider) {
        const value = slider.value;
        slider.style.setProperty("--value", value + "%");
        slider.style.background = `linear-gradient(to right, #00ff88 0%, #00ff88 ${value}%, #333 ${value}%)`;
      }

      // ÎßàÏßÑ Í≥ÑÏÇ∞Í∏∞
      function calculateMargin() {
        const salePrice =
          parseFloat(document.getElementById("marginSalePrice").value) || 0;
        const cost =
          parseFloat(document.getElementById("marginCost").value) || 0;
        const shipping =
          parseFloat(document.getElementById("marginShipping").value) || 0;
        const box = parseFloat(document.getElementById("marginBox").value) || 0;

        if (salePrice <= 0) {
          showToast("error", "ÌåêÎß§Í∞ÄÎ•º ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî");
          return;
        }

        const totalCost = cost + shipping + box;

        // ÌîåÎû´ÌèºÎ≥Ñ ÏàòÏàòÎ£åÏú®
        const platforms = {
          coupang: { rate: 0.88, name: "Ïø†Ìå°" },
          smartstore: { rate: 0.933, name: "Ïä§ÎßàÌä∏Ïä§ÌÜ†Ïñ¥" },
          esm: { rate: 0.85, name: "ESM" },
        };

        // Í∞Å ÌîåÎû´ÌèºÎ≥Ñ ÎßàÏßÑ Í≥ÑÏÇ∞
        Object.keys(platforms).forEach((platform) => {
          const rate = platforms[platform].rate;
          const margin = salePrice * rate - totalCost;
          const marginRate = (margin / salePrice) * 100;

          // ÎßàÏßÑ ÌëúÏãú
          const marginEl = document.getElementById(`${platform}Margin`);
          const rateEl = document.getElementById(`${platform}Rate`);

          marginEl.textContent = formatCurrency(margin) + "Ïõê";
          rateEl.textContent = marginRate.toFixed(1) + "%";

          // ÏùåÏàòÎ©¥ Îπ®Í∞ÑÏÉâ
          if (margin < 0) {
            marginEl.classList.add("negative");
            rateEl.classList.remove("highlight");
            rateEl.classList.add("negative");
          } else {
            marginEl.classList.remove("negative");
            rateEl.classList.add("highlight");
            rateEl.classList.remove("negative");
          }
        });

        // Í≤∞Í≥º ÌëúÏãú
        document.getElementById("marginResults").style.display = "flex";
      }

      // ÌåêÎß§Í∞Ä Ï±ÖÏ†ïÍ∏∞
      function calculatePrice() {
        const cost =
          parseFloat(document.getElementById("priceCost").value) || 0;
        const shipping =
          parseFloat(document.getElementById("priceShipping").value) || 0;
        const box = parseFloat(document.getElementById("priceBox").value) || 0;
        const targetMargin =
          parseFloat(document.getElementById("targetMarginSlider").value) / 100;

        const totalCost = cost + shipping + box;

        if (totalCost <= 0) {
          document.getElementById("coupangPrice").textContent = "0Ïõê";
          document.getElementById("smartstorePrice").textContent = "0Ïõê";
          document.getElementById("esmPrice").textContent = "0Ïõê";
          return;
        }

        // ÌîåÎû´ÌèºÎ≥Ñ ÏàòÏàòÎ£åÏú® (ÌåêÎß§Í∞Ä ÎåÄÎπÑ ÏàòÏ∑®Ïú®)
        const platforms = {
          coupang: { rate: 0.88 }, // 12% ÏàòÏàòÎ£å
          smartstore: { rate: 0.933 }, // 6.7% ÏàòÏàòÎ£å
          esm: { rate: 0.85 }, // 15% ÏàòÏàòÎ£å
        };

        // ÌåêÎß§Í∞Ä = ÏõêÍ∞ÄÏ¥ùÌï© / (ÏàòÏ∑®Ïú® - ÎßàÏßÑÎ•†)
        // ÎßàÏßÑ = ÌåêÎß§Í∞Ä * ÎßàÏßÑÎ•†
        // ÏàòÏ∑®Í∏àÏï° = ÌåêÎß§Í∞Ä * ÏàòÏ∑®Ïú® = ÏõêÍ∞ÄÏ¥ùÌï© + ÎßàÏßÑ
        Object.keys(platforms).forEach((platform) => {
          const feeRate = platforms[platform].rate;
          let price = 0;

          // ÏàòÏ∑®Ïú® - ÎßàÏßÑÎ•†Ïù¥ 0Î≥¥Îã§ Ïª§Ïïº Ìï®
          const denominator = feeRate - targetMargin;

          if (denominator > 0) {
            price = totalCost / denominator;
          } else {
            price = 0; // Î∂àÍ∞ÄÎä•Ìïú ÎßàÏßÑÎ•†
          }

          const priceEl = document.getElementById(`${platform}Price`);

          if (price > 0 && isFinite(price)) {
            priceEl.textContent = formatCurrency(Math.ceil(price)) + "Ïõê";
            priceEl.style.color = "#00ff88";
          } else {
            priceEl.textContent = "Í≥ÑÏÇ∞Î∂àÍ∞Ä";
            priceEl.style.color = "#ff6b6b";
          }
        });
      }

      // ÌÜµÌôî Ìè¨Îß∑
      function formatCurrency(num) {
        return Math.round(num).toLocaleString();
      }

      // ==================== ÏßÅÏõê Í¥ÄÎ¶¨ ====================

      let employeesData = [];

      async function loadEmployees() {
        try {
          const response = await fetch("/api/employees");
          const result = await response.json();

          if (result.success) {
            employeesData = result.data;
            renderEmployeeList();
          } else {
            document.getElementById("employeeList").innerHTML =
              '<div style="text-align: center; padding: 20px; color: #ff6b6b;">Î°úÎìú Ïã§Ìå®</div>';
          }
        } catch (error) {
          console.error("ÏßÅÏõê Î°úÎìú Ïò§Î•ò:", error);
        }
      }

      function renderEmployeeList() {
        const container = document.getElementById("employeeList");

        if (!employeesData.length) {
          container.innerHTML =
            '<div style="text-align: center; padding: 40px; color: #666;">Îì±Î°ùÎêú ÏßÅÏõêÏù¥ ÏóÜÏäµÎãàÎã§</div>';
          return;
        }

        let html = '<div style="display: grid; gap: 15px;">';

        employeesData.forEach((emp) => {
          const statusBadge = emp.enabled
            ? '<span style="background: rgba(0,255,136,0.2); color: #00ff88; padding: 4px 10px; border-radius: 12px; font-size: 12px;">ÌôúÏÑ±</span>'
            : '<span style="background: rgba(255,107,107,0.2); color: #ff6b6b; padding: 4px 10px; border-radius: 12px; font-size: 12px;">ÎπÑÌôúÏÑ±</span>';

          html += `
            <div style="display: flex; justify-content: space-between; align-items: center; padding: 15px 20px; background: #1a1a1a; border-radius: 12px;">
              <div style="display: flex; align-items: center; gap: 15px;">
                <div style="width: 45px; height: 45px; background: #222; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 20px;">üë§</div>
                <div>
                  <div style="font-weight: 600; margin-bottom: 4px;">${
                    emp.name
                  } ${statusBadge}</div>
                  <div style="color: #666; font-size: 13px;">ID: ${
                    emp.username
                  } | ÏãúÍ∏â: ${emp.hourly_wage.toLocaleString()}Ïõê | ÎßåÍ∑º: ${(
            emp.full_attendance_bonus || 100000
          ).toLocaleString()}Ïõê</div>
                </div>
              </div>
              <div style="display: flex; gap: 8px;">
                <button onclick="showEditEmployeeModal(${
                  emp.id
                })" style="padding: 8px 12px; background: #333; border: none; border-radius: 6px; color: #fff; cursor: pointer;">‚úèÔ∏è ÏàòÏ†ï</button>
                <button onclick="toggleEmployeeStatus(${emp.id}, ${
            emp.enabled
          })" style="padding: 8px 12px; background: ${
            emp.enabled ? "#ff4444" : "#00cc6a"
          }; border: none; border-radius: 6px; color: #fff; cursor: pointer;">
                  ${emp.enabled ? "üö´ ÎπÑÌôúÏÑ±Ìôî" : "‚úÖ ÌôúÏÑ±Ìôî"}
                </button>
              </div>
            </div>
          `;
        });

        html += "</div>";
        container.innerHTML = html;
      }

      function showAddEmployeeModal() {
        const modal = `
          <div class="modal-overlay show" id="employeeModal" onclick="if(event.target===this)this.remove()">
            <div class="modal" style="max-width: 500px;">
              <div class="modal-header">
                <div class="modal-icon">üë§</div>
                <div class="modal-title">ÏßÅÏõê Ï∂îÍ∞Ä</div>
              </div>
              <div style="display: grid; gap: 15px; padding: 20px 0;">
                <div>
                  <label style="display: block; color: #888; font-size: 13px; margin-bottom: 5px;">Ïù¥Î¶Ñ *</label>
                  <input type="text" id="empName" placeholder="Ïù¥Î¶Ñ" style="width: 100%; padding: 12px; background: #222; border: 1px solid #333; border-radius: 8px; color: #fff; box-sizing: border-box;">
                </div>
                <div>
                  <label style="display: block; color: #888; font-size: 13px; margin-bottom: 5px;">ÏïÑÏù¥Îîî *</label>
                  <input type="text" id="empUsername" placeholder="Î°úÍ∑∏Ïù∏ ÏïÑÏù¥Îîî" style="width: 100%; padding: 12px; background: #222; border: 1px solid #333; border-radius: 8px; color: #fff; box-sizing: border-box;">
                </div>
                <div>
                  <label style="display: block; color: #888; font-size: 13px; margin-bottom: 5px;">ÎπÑÎ∞ÄÎ≤àÌò∏ *</label>
                  <input type="password" id="empPassword" placeholder="ÎπÑÎ∞ÄÎ≤àÌò∏" style="width: 100%; padding: 12px; background: #222; border: 1px solid #333; border-radius: 8px; color: #fff; box-sizing: border-box;">
                </div>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                  <div>
                    <label style="display: block; color: #888; font-size: 13px; margin-bottom: 5px;">ÏãúÍ∏â</label>
                    <input type="number" id="empWage" value="10700" style="width: 100%; padding: 12px; background: #222; border: 1px solid #333; border-radius: 8px; color: #fff; box-sizing: border-box;">
                  </div>
                  <div>
                    <label style="display: block; color: #888; font-size: 13px; margin-bottom: 5px;">ÎßåÍ∑ºÏàòÎãπ</label>
                    <input type="number" id="empBonus" value="100000" style="width: 100%; padding: 12px; background: #222; border: 1px solid #333; border-radius: 8px; color: #fff; box-sizing: border-box;">
                  </div>
                </div>
                <div>
                  <label style="display: block; color: #888; font-size: 13px; margin-bottom: 8px;">ÏÜåÏ†ïÍ∑ºÎ°úÏùº</label>
                  <div style="display: flex; gap: 6px; flex-wrap: wrap;">
                    <div class="day-toggle selected" data-day="1" onclick="toggleDay(this)" style="width: 42px; height: 42px; display: flex; align-items: center; justify-content: center; background: #00ff88; color: #000; border-radius: 8px; cursor: pointer; font-weight: 600; font-size: 14px; transition: all 0.2s;">Ïõî</div>
                    <div class="day-toggle selected" data-day="2" onclick="toggleDay(this)" style="width: 42px; height: 42px; display: flex; align-items: center; justify-content: center; background: #00ff88; color: #000; border-radius: 8px; cursor: pointer; font-weight: 600; font-size: 14px; transition: all 0.2s;">Ìôî</div>
                    <div class="day-toggle selected" data-day="3" onclick="toggleDay(this)" style="width: 42px; height: 42px; display: flex; align-items: center; justify-content: center; background: #00ff88; color: #000; border-radius: 8px; cursor: pointer; font-weight: 600; font-size: 14px; transition: all 0.2s;">Ïàò</div>
                    <div class="day-toggle selected" data-day="4" onclick="toggleDay(this)" style="width: 42px; height: 42px; display: flex; align-items: center; justify-content: center; background: #00ff88; color: #000; border-radius: 8px; cursor: pointer; font-weight: 600; font-size: 14px; transition: all 0.2s;">Î™©</div>
                    <div class="day-toggle selected" data-day="5" onclick="toggleDay(this)" style="width: 42px; height: 42px; display: flex; align-items: center; justify-content: center; background: #00ff88; color: #000; border-radius: 8px; cursor: pointer; font-weight: 600; font-size: 14px; transition: all 0.2s;">Í∏à</div>
                    <div class="day-toggle" data-day="6" onclick="toggleDay(this)" style="width: 42px; height: 42px; display: flex; align-items: center; justify-content: center; background: #222; color: #666; border: 1px solid #333; border-radius: 8px; cursor: pointer; font-weight: 600; font-size: 14px; transition: all 0.2s;">ÌÜ†</div>
                    <div class="day-toggle" data-day="0" onclick="toggleDay(this)" style="width: 42px; height: 42px; display: flex; align-items: center; justify-content: center; background: #222; color: #666; border: 1px solid #333; border-radius: 8px; cursor: pointer; font-weight: 600; font-size: 14px; transition: all 0.2s;">Ïùº</div>
                  </div>
                </div>
              </div>
              <div class="modal-actions">
                <button class="btn btn-primary" onclick="saveEmployee()">Ï†ÄÏû•</button>
                <button class="btn btn-outline" onclick="document.getElementById('employeeModal').remove()">Ï∑®ÏÜå</button>
              </div>
            </div>
          </div>
        `;
        document.body.insertAdjacentHTML("beforeend", modal);
      }

      function toggleDay(el) {
        const isSelected = el.classList.contains('selected');
        if (isSelected) {
          el.classList.remove('selected');
          el.style.background = '#222';
          el.style.color = '#666';
          el.style.border = '1px solid #333';
        } else {
          el.classList.add('selected');
          el.style.background = '#00ff88';
          el.style.color = '#000';
          el.style.border = 'none';
        }
      }

      function getSelectedDays() {
        const dayToggles = document.querySelectorAll('#employeeModal .day-toggle.selected');
        const days = [];
        dayToggles.forEach(el => days.push(el.dataset.day));
        return days.join(',');
      }

      function showEditEmployeeModal(empId) {
        const emp = employeesData.find((e) => e.id === empId);
        if (!emp) return;

        const scheduledDays = (emp.scheduled_days || '1,2,3,4,5').split(',');
        const dayNames = ['Ïùº', 'Ïõî', 'Ìôî', 'Ïàò', 'Î™©', 'Í∏à', 'ÌÜ†'];

        let dayToggles = '';
        [1, 2, 3, 4, 5, 6, 0].forEach(dayNum => {
          const isSelected = scheduledDays.includes(String(dayNum));
          const bgColor = isSelected ? '#00ff88' : '#222';
          const textColor = isSelected ? '#000' : '#666';
          const border = isSelected ? 'none' : '1px solid #333';
          const selectedClass = isSelected ? 'selected' : '';
          dayToggles += \`<div class="day-toggle \${selectedClass}" data-day="\${dayNum}" onclick="toggleDay(this)" style="width: 42px; height: 42px; display: flex; align-items: center; justify-content: center; background: \${bgColor}; color: \${textColor}; border: \${border}; border-radius: 8px; cursor: pointer; font-weight: 600; font-size: 14px; transition: all 0.2s;">\${dayNames[dayNum]}</div>\`;
        });

        const modal = `
          <div class="modal-overlay show" id="employeeModal" onclick="if(event.target===this)this.remove()">
            <div class="modal" style="max-width: 500px;">
              <div class="modal-header">
                <div class="modal-icon">‚úèÔ∏è</div>
                <div class="modal-title">ÏßÅÏõê ÏàòÏ†ï</div>
              </div>
              <div style="display: grid; gap: 15px; padding: 20px 0;">
                <input type="hidden" id="empId" value="${emp.id}">
                <div>
                  <label style="display: block; color: #888; font-size: 13px; margin-bottom: 5px;">Ïù¥Î¶Ñ</label>
                  <input type="text" id="empName" value="${
                    emp.name
                  }" style="width: 100%; padding: 12px; background: #222; border: 1px solid #333; border-radius: 8px; color: #fff; box-sizing: border-box;">
                </div>
                <div>
                  <label style="display: block; color: #888; font-size: 13px; margin-bottom: 5px;">ÏïÑÏù¥Îîî (Î≥ÄÍ≤Ω Î∂àÍ∞Ä)</label>
                  <input type="text" value="${
                    emp.username
                  }" disabled style="width: 100%; padding: 12px; background: #1a1a1a; border: 1px solid #222; border-radius: 8px; color: #666; box-sizing: border-box;">
                </div>
                <div>
                  <label style="display: block; color: #888; font-size: 13px; margin-bottom: 5px;">ÏÉà ÎπÑÎ∞ÄÎ≤àÌò∏ (Î≥ÄÍ≤Ω ÏãúÏóêÎßå)</label>
                  <input type="password" id="empPassword" placeholder="Î≥ÄÍ≤ΩÌï† ÎπÑÎ∞ÄÎ≤àÌò∏" style="width: 100%; padding: 12px; background: #222; border: 1px solid #333; border-radius: 8px; color: #fff; box-sizing: border-box;">
                </div>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                  <div>
                    <label style="display: block; color: #888; font-size: 13px; margin-bottom: 5px;">ÏãúÍ∏â</label>
                    <input type="number" id="empWage" value="${
                      emp.hourly_wage
                    }" style="width: 100%; padding: 12px; background: #222; border: 1px solid #333; border-radius: 8px; color: #fff; box-sizing: border-box;">
                  </div>
                  <div>
                    <label style="display: block; color: #888; font-size: 13px; margin-bottom: 5px;">ÎßåÍ∑ºÏàòÎãπ</label>
                    <input type="number" id="empBonus" value="${
                      emp.full_attendance_bonus || 100000
                    }" style="width: 100%; padding: 12px; background: #222; border: 1px solid #333; border-radius: 8px; color: #fff; box-sizing: border-box;">
                  </div>
                </div>
                <div>
                  <label style="display: block; color: #888; font-size: 13px; margin-bottom: 8px;">ÏÜåÏ†ïÍ∑ºÎ°úÏùº</label>
                  <div style="display: flex; gap: 6px; flex-wrap: wrap;">
                    ${dayToggles}
                  </div>
                </div>
              </div>
              <div class="modal-actions">
                <button class="btn btn-primary" onclick="updateEmployee()">Ï†ÄÏû•</button>
                <button class="btn btn-outline" onclick="document.getElementById('employeeModal').remove()">Ï∑®ÏÜå</button>
              </div>
            </div>
          </div>
        `;
        document.body.insertAdjacentHTML("beforeend", modal);
      }

      async function saveEmployee() {
        const data = {
          name: document.getElementById("empName").value.trim(),
          username: document.getElementById("empUsername").value.trim(),
          password: document.getElementById("empPassword").value,
          hourly_wage:
            parseInt(document.getElementById("empWage").value) || 10700,
          full_attendance_bonus:
            parseInt(document.getElementById("empBonus").value) || 100000,
          scheduled_days: getSelectedDays() || '1,2,3,4,5',
        };

        if (!data.name || !data.username || !data.password) {
          showToast("error", "ÌïÑÏàò Ìï≠Î™©ÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî");
          return;
        }

        try {
          const response = await fetch("/api/employees", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(data),
          });

          const result = await response.json();

          if (result.success) {
            showToast("success", "ÏßÅÏõêÏù¥ Ï∂îÍ∞ÄÎêòÏóàÏäµÎãàÎã§");
            document.getElementById("employeeModal").remove();
            loadEmployees();
          } else {
            showToast("error", result.error || "Ï∂îÍ∞Ä Ïã§Ìå®");
          }
        } catch (error) {
          showToast("error", "ÏÑúÎ≤Ñ Ïò§Î•ò");
        }
      }

      async function updateEmployee() {
        const empId = document.getElementById("empId").value;
        const data = {
          name: document.getElementById("empName").value.trim(),
          password: document.getElementById("empPassword").value || undefined,
          hourly_wage:
            parseInt(document.getElementById("empWage").value) || 10700,
          full_attendance_bonus:
            parseInt(document.getElementById("empBonus").value) || 100000,
          scheduled_days: getSelectedDays() || '1,2,3,4,5',
        };

        try {
          const response = await fetch(`/api/employees/${empId}`, {
            method: "PUT",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(data),
          });

          const result = await response.json();

          if (result.success) {
            showToast("success", "ÏßÅÏõê Ï†ïÎ≥¥Í∞Ä ÏàòÏ†ïÎêòÏóàÏäµÎãàÎã§");
            document.getElementById("employeeModal").remove();
            loadEmployees();
          } else {
            showToast("error", result.error || "ÏàòÏ†ï Ïã§Ìå®");
          }
        } catch (error) {
          showToast("error", "ÏÑúÎ≤Ñ Ïò§Î•ò");
        }
      }

      async function toggleEmployeeStatus(empId, currentStatus) {
        const action = currentStatus ? "ÎπÑÌôúÏÑ±Ìôî" : "ÌôúÏÑ±Ìôî";
        if (!confirm(`Ïù¥ ÏßÅÏõêÏùÑ ${action}ÌïòÏãúÍ≤†ÏäµÎãàÍπå?`)) return;

        try {
          const response = await fetch(`/api/employees/${empId}`, {
            method: "PUT",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ enabled: !currentStatus }),
          });

          const result = await response.json();

          if (result.success) {
            showToast("success", `ÏßÅÏõêÏù¥ ${action}ÎêòÏóàÏäµÎãàÎã§`);
            loadEmployees();
          } else {
            showToast("error", result.error || "Ï≤òÎ¶¨ Ïã§Ìå®");
          }
        } catch (error) {
          showToast("error", "ÏÑúÎ≤Ñ Ïò§Î•ò");
        }
      }

      // ==================== Í≥µÌú¥Ïùº Í¥ÄÎ¶¨ ====================

      let holidaysData = [];

      async function loadHolidays() {
        const year =
          document.getElementById("holidayYear")?.value ||
          new Date().getFullYear();
        const month =
          document.getElementById("holidayMonth")?.value ||
          new Date().getMonth() + 1;

        try {
          const response = await fetch(
            `/api/holidays?year=${year}&month=${month}`
          );
          const result = await response.json();

          if (result.success) {
            holidaysData = result.data;
            renderHolidayList();
          }
        } catch (error) {
          console.error("Í≥µÌú¥Ïùº Î°úÎìú Ïò§Î•ò:", error);
        }
      }

      function renderHolidayList() {
        const container = document.getElementById("holidayList");

        if (!holidaysData.length) {
          container.innerHTML =
            '<div style="text-align: center; padding: 20px; color: #666;">Îì±Î°ùÎêú Í≥µÌú¥ÏùºÏù¥ ÏóÜÏäµÎãàÎã§</div>';
          return;
        }

        let html = '<div style="display: flex; flex-wrap: wrap; gap: 10px;">';

        holidaysData.forEach((h) => {
          const dateObj = new Date(h.holiday_date);
          const dayNames = ["Ïùº", "Ïõî", "Ìôî", "Ïàò", "Î™©", "Í∏à", "ÌÜ†"];
          html += `
            <div style="display: inline-flex; align-items: center; gap: 10px; padding: 10px 15px; background: #222; border-radius: 8px;">
              <span>üìÖ ${dateObj.getMonth() + 1}/${dateObj.getDate()} (${
            dayNames[dateObj.getDay()]
          }) - ${h.name}</span>
              <button onclick="deleteHoliday(${
                h.id
              })" style="background: none; border: none; color: #ff6b6b; cursor: pointer; font-size: 16px;">‚úï</button>
            </div>
          `;
        });

        html += "</div>";
        container.innerHTML = html;
      }

      function showAddHolidayModal() {
        const modal = `
          <div class="modal-overlay show" id="holidayModal" onclick="if(event.target===this)this.remove()">
            <div class="modal" style="max-width: 400px;">
              <div class="modal-header">
                <div class="modal-icon">üìÖ</div>
                <div class="modal-title">Í≥µÌú¥Ïùº Ï∂îÍ∞Ä</div>
              </div>
              <div style="display: grid; gap: 15px; padding: 20px 0;">
                <div>
                  <label style="display: block; color: #888; font-size: 13px; margin-bottom: 5px;">ÎÇ†Ïßú *</label>
                  <input type="date" id="holidayDate" style="width: 100%; padding: 12px; background: #222; border: 1px solid #333; border-radius: 8px; color: #fff; box-sizing: border-box;">
                </div>
                <div>
                  <label style="display: block; color: #888; font-size: 13px; margin-bottom: 5px;">Í≥µÌú¥ÏùºÎ™Ö</label>
                  <input type="text" id="holidayName" placeholder="Ïòà: ÏÑ§ÎÇ†, Ï∂îÏÑù" style="width: 100%; padding: 12px; background: #222; border: 1px solid #333; border-radius: 8px; color: #fff; box-sizing: border-box;">
                </div>
              </div>
              <div class="modal-actions">
                <button class="btn btn-primary" onclick="saveHoliday()">Ï∂îÍ∞Ä</button>
                <button class="btn btn-outline" onclick="document.getElementById('holidayModal').remove()">Ï∑®ÏÜå</button>
              </div>
            </div>
          </div>
        `;
        document.body.insertAdjacentHTML("beforeend", modal);
      }

      async function saveHoliday() {
        const date = document.getElementById("holidayDate").value;
        const name =
          document.getElementById("holidayName").value.trim() || "Í≥µÌú¥Ïùº";

        if (!date) {
          showToast("error", "ÎÇ†ÏßúÎ•º ÏÑ†ÌÉùÌï¥Ï£ºÏÑ∏Ïöî");
          return;
        }

        try {
          const response = await fetch("/api/holidays", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ date, name }),
          });

          const result = await response.json();

          if (result.success) {
            showToast("success", "Í≥µÌú¥ÏùºÏù¥ Ï∂îÍ∞ÄÎêòÏóàÏäµÎãàÎã§");
            document.getElementById("holidayModal").remove();
            loadHolidays();
          } else {
            showToast("error", result.error || "Ï∂îÍ∞Ä Ïã§Ìå®");
          }
        } catch (error) {
          showToast("error", "ÏÑúÎ≤Ñ Ïò§Î•ò");
        }
      }

      async function deleteHoliday(holidayId) {
        if (!confirm("Ïù¥ Í≥µÌú¥ÏùºÏùÑ ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?")) return;

        try {
          const response = await fetch(`/api/holidays/${holidayId}`, {
            method: "DELETE",
          });
          const result = await response.json();

          if (result.success) {
            showToast("success", "Í≥µÌú¥ÏùºÏù¥ ÏÇ≠Ï†úÎêòÏóàÏäµÎãàÎã§");
            loadHolidays();
          } else {
            showToast("error", result.error || "ÏÇ≠Ï†ú Ïã§Ìå®");
          }
        } catch (error) {
          showToast("error", "ÏÑúÎ≤Ñ Ïò§Î•ò");
        }
      }

      // ==================== ÏßÅÏõê Ï∂úÌá¥Í∑ºÏùºÏßÄ (Í¥ÄÎ¶¨Ïûê) ====================

      let adminAttendanceData = [];
      let adminPendingRequests = []; // ÏßÅÏõêÎì§Ïùò ÎåÄÍ∏∞Ï§ëÏù∏ ÏàòÏ†ï ÏöîÏ≤≠

      async function loadAdminAttendance() {
        const year =
          document.getElementById("adminAttYear")?.value ||
          new Date().getFullYear();
        const month =
          document.getElementById("adminAttMonth")?.value ||
          new Date().getMonth() + 1;

        try {
          // Ï∂úÌá¥Í∑º Îç∞Ïù¥ÌÑ∞ÏôÄ ÏàòÏ†ï ÏöîÏ≤≠ÏùÑ ÎèôÏãúÏóê Î°úÎìú
          const [attResponse, reqResponse] = await Promise.all([
            fetch(`/api/admin/attendance?year=${year}&month=${month}`),
            fetch("/api/attendance-edit-requests?status=pending"),
          ]);

          const attResult = await attResponse.json();
          const reqResult = await reqResponse.json();

          if (attResult.success) {
            adminAttendanceData = attResult.data;
            adminPendingRequests = reqResult.success
              ? reqResult.data || []
              : [];
            renderAdminAttendance();
          } else {
            document.getElementById("adminAttendanceList").innerHTML =
              '<div style="text-align: center; padding: 20px; color: #ff6b6b;">Î°úÎìú Ïã§Ìå®</div>';
          }
        } catch (error) {
          console.error("Ï∂úÌá¥Í∑º Î°úÎìú Ïò§Î•ò:", error);
        }
      }

      function renderAdminAttendance() {
        const container = document.getElementById("adminAttendanceList");

        if (!adminAttendanceData.length) {
          container.innerHTML =
            '<div style="text-align: center; padding: 40px; color: #666;">Îì±Î°ùÎêú ÏßÅÏõêÏù¥ ÏóÜÏäµÎãàÎã§</div>';
          return;
        }

        let html = "";

        adminAttendanceData.forEach((empData) => {
          const emp = empData.employee;
          const records = empData.records;
          const isConfirmed = empData.is_confirmed;
          const confirmation = empData.confirmation;

          // ÏöîÏïΩ Í≥ÑÏÇ∞
          let totalHours = 0;
          let workDays = 0;
          let incompleteCount = 0;
          let basePay = 0;
          let overtimePay = 0;

          records.forEach((r) => {
            if (r.clock_in && r.clock_out) {
              workDays++;
              const [inH, inM] = r.clock_in.split(":").map(Number);
              const [outH, outM] = r.clock_out.split(":").map(Number);
              let mins = outH * 60 + outM - (inH * 60 + inM);
              // Ï†êÏã¨ÏãúÍ∞Ñ Í≥µÏ†ú
              if (inH < 13 && outH >= 12) mins -= 60;
              totalHours += mins / 60;

              // Í∏âÏó¨ Í≥ÑÏÇ∞ (Ï†ïÍ∑ú 8ÏãúÍ∞Ñ Í∏∞Ï§Ä)
              const dailyHours = mins / 60;
              const regularHours = Math.min(dailyHours, 8);
              const overtimeHours = Math.max(0, dailyHours - 8);
              const multiplier = r.is_holiday_work ? 1.5 : 1.0;
              basePay += regularHours * emp.hourly_wage * multiplier;
              overtimePay += overtimeHours * emp.hourly_wage * 1.5 * multiplier;
            } else if (r.clock_in || r.clock_out) {
              incompleteCount++;
            }
          });

          const estimatedPay = Math.round(basePay + overtimePay);

          html += `
            <div style="background: #1a1a1a; border-radius: 12px; margin-bottom: 20px; overflow: hidden;">
              <div style="padding: 20px; border-bottom: 1px solid #222; display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 15px;">
                <div style="flex: 1; min-width: 200px;">
                  <div style="font-size: 18px; font-weight: 600; margin-bottom: 8px;">
                    ${emp.name}
                    ${
                      isConfirmed
                        ? '<span style="background: rgba(0,255,136,0.2); color: #00ff88; padding: 4px 10px; border-radius: 12px; font-size: 12px; margin-left: 10px;">ÌôïÏ†ïÎê®</span>'
                        : ""
                    }
                  </div>
                  <div style="display: flex; flex-wrap: wrap; gap: 15px; color: #888; font-size: 13px;">
                    <span>üìÖ Ï∂úÍ∑º <strong style="color: #00ff88;">${workDays}Ïùº</strong></span>
                    <span>‚è±Ô∏è Í∑ºÎ¨¥ <strong style="color: #00ff88;">${totalHours.toFixed(
                      1
                    )}ÏãúÍ∞Ñ</strong></span>
                    <span>üí∞ ÏòàÏÉÅ <strong style="color: #ffd700;">${estimatedPay.toLocaleString()}Ïõê</strong></span>
                    ${
                      incompleteCount > 0
                        ? `<span style="color: #ff6b6b;">‚ö†Ô∏è ÎØ∏ÏôÑÎ£å ${incompleteCount}Í±¥</span>`
                        : ""
                    }
                  </div>
                </div>
                <button onclick="toggleAttendanceDetail(${
                  emp.id
                })" style="padding: 10px 20px; background: #333; border: none; border-radius: 8px; color: #fff; cursor: pointer; font-size: 14px;">
                  üìã ÏÉÅÏÑ∏Î≥¥Í∏∞
                </button>
              </div>

              ${
                isConfirmed
                  ? `
                <div style="padding: 15px 20px; background: rgba(0,255,136,0.05); border-top: 1px solid rgba(0,255,136,0.2);">
                  <div style="color: #00ff88; font-weight: 500;">‚úÖ ${
                    emp.name
                  }ÎãòÏùÄ Ïù¥Î≤àÎã¨ Í∏âÏó¨Ïóê ÎèôÏùòÌïòÏòÄÏäµÎãàÎã§.</div>
                  <div style="color: #888; font-size: 13px; margin-top: 5px;">
                    ÌôïÏ†ï Í∏àÏï°: ${(
                      confirmation?.total_amount || 0
                    ).toLocaleString()}Ïõê |
                    ÌôïÏ†ïÏùº: ${new Date(
                      confirmation?.confirmed_at
                    ).toLocaleString()}
                  </div>
                </div>
              `
                  : ""
              }

              <div id="detail-${
                emp.id
              }" style="display: none; padding: 15px 20px; max-height: 400px; overflow-y: auto;">
                ${renderAttendanceDetailTable(
                  records,
                  emp.id,
                  adminPendingRequests.filter((r) => r.employee_id === emp.id)
                )}
              </div>
            </div>
          `;
        });

        container.innerHTML = html;
      }

      function renderAttendanceDetailTable(
        records,
        empId,
        pendingRequests = []
      ) {
        if (!records.length) {
          return '<div style="text-align: center; padding: 20px; color: #666;">Ï∂úÌá¥Í∑º Í∏∞Î°ùÏù¥ ÏóÜÏäµÎãàÎã§</div>';
        }

        // pending ÏöîÏ≤≠ÏùÑ ÎÇ†ÏßúÎ≥ÑÎ°ú ÎßµÌïë
        const pendingByDate = {};
        pendingRequests.forEach((req) => {
          pendingByDate[req.request_date] = req;
        });

        let html = `
          <table style="width: 100%; border-collapse: collapse;">
            <thead>
              <tr style="background: #222;">
                <th style="padding: 10px; text-align: left; border-bottom: 1px solid #333;">ÎÇ†Ïßú</th>
                <th style="padding: 10px; text-align: center; border-bottom: 1px solid #333;">Ï∂úÍ∑º</th>
                <th style="padding: 10px; text-align: center; border-bottom: 1px solid #333;">Ìá¥Í∑º</th>
                <th style="padding: 10px; text-align: center; border-bottom: 1px solid #333;">Í∑ºÎ¨¥ÏãúÍ∞Ñ</th>
                <th style="padding: 10px; text-align: center; border-bottom: 1px solid #333;">ÏàòÏ†ïÏäπÏù∏</th>
              </tr>
            </thead>
            <tbody>
        `;

        records.forEach((r) => {
          const isIncomplete =
            (r.clock_in && !r.clock_out) || (!r.clock_in && r.clock_out);
          const rowStyle = isIncomplete
            ? "background: rgba(255,107,107,0.1);"
            : "";

          let hours = "-";
          if (r.clock_in && r.clock_out) {
            const [inH, inM] = r.clock_in.split(":").map(Number);
            const [outH, outM] = r.clock_out.split(":").map(Number);
            let mins = outH * 60 + outM - (inH * 60 + inM);
            if (inH < 13 && outH >= 12) mins -= 60;
            hours = (mins / 60).toFixed(1) + "h";
          }

          // Ìï¥Îãπ ÎÇ†ÏßúÏóê ÏàòÏ†ï ÏöîÏ≤≠Ïù¥ ÏûàÎäîÏßÄ ÌôïÏù∏
          const hasPendingRequest = !!pendingByDate[r.work_date];
          let approvalCell = '<span style="color: #666;">-</span>';

          if (hasPendingRequest) {
            approvalCell = `<button onclick="approveEdit(${empId}, '${r.work_date}')" style="padding: 4px 8px; background: #ffd700; border: none; border-radius: 4px; color: #000; cursor: pointer; font-size: 12px; font-weight: 500;">ÏäπÏù∏</button>`;
          }

          html += `
            <tr style="${rowStyle}">
              <td style="padding: 10px; border-bottom: 1px solid #222;">${
                r.work_date
              }</td>
              <td style="padding: 10px; text-align: center; border-bottom: 1px solid #222;">${
                r.clock_in ? r.clock_in.substring(0, 5) : "-"
              }</td>
              <td style="padding: 10px; text-align: center; border-bottom: 1px solid #222;">${
                r.clock_out ? r.clock_out.substring(0, 5) : "-"
              }</td>
              <td style="padding: 10px; text-align: center; border-bottom: 1px solid #222; color: #00ff88;">${hours}</td>
              <td style="padding: 10px; text-align: center; border-bottom: 1px solid #222;">
                ${approvalCell}
              </td>
            </tr>
          `;
        });

        html += "</tbody></table>";
        return html;
      }

      function toggleAttendanceDetail(empId) {
        const detail = document.getElementById(`detail-${empId}`);
        if (detail) {
          detail.style.display =
            detail.style.display === "none" ? "block" : "none";
        }
      }

      async function approveEdit(empId, date) {
        if (
          !confirm(
            `${date} Ï∂úÌá¥Í∑º Í∏∞Î°ù ÏàòÏ†ïÏùÑ ÏäπÏù∏ÌïòÏãúÍ≤†ÏäµÎãàÍπå?\n(Ìï¥Îãπ ÏàòÏ†ï ÏöîÏ≤≠Ïù¥ Î∞òÏòÅÎê©ÎãàÎã§)`
          )
        )
          return;

        try {
          // Î®ºÏ†Ä Ìï¥Îãπ ÎÇ†ÏßúÏùò ÏàòÏ†ï ÏöîÏ≤≠ÏùÑ Ï∞æÏïÑÏÑú ÏäπÏù∏
          const pendingReq = adminPendingRequests.find(
            (r) => r.employee_id === empId && r.request_date === date
          );

          if (pendingReq) {
            // ÏàòÏ†ï ÏöîÏ≤≠ ÏäπÏù∏ API Ìò∏Ï∂ú
            const response = await fetch(
              `/api/attendance-edit-request/${pendingReq.id}/approve`,
              {
                method: "POST",
              }
            );

            const result = await response.json();

            if (result.success) {
              showToast("success", `${date} ÏàòÏ†ï ÏöîÏ≤≠Ïù¥ ÏäπÏù∏ÎêòÏóàÏäµÎãàÎã§`);
              loadAdminAttendance(); // Îç∞Ïù¥ÌÑ∞ ÏÉàÎ°úÍ≥†Ïπ®
              loadEditRequests(); // ÏàòÏ†ï ÏöîÏ≤≠ Î™©Î°ùÎèÑ ÏÉàÎ°úÍ≥†Ïπ®
            } else {
              showToast("error", result.error || "ÏäπÏù∏ Ïã§Ìå®");
            }
          } else {
            showToast("error", "Ìï¥Îãπ ÎÇ†ÏßúÏùò ÏàòÏ†ï ÏöîÏ≤≠ÏùÑ Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§");
          }
        } catch (error) {
          showToast("error", "ÏÑúÎ≤Ñ Ïò§Î•ò");
        }
      }

      // ==================== ÌéòÏù¥ÏßÄ Ï†ÑÌôò Ïãú Îç∞Ïù¥ÌÑ∞ Î°úÎìú ====================

      const originalSetupNavigation = setupNavigation;
      setupNavigation = function () {
        // Í≥µÌÜµ ÌéòÏù¥ÏßÄ Ï†ÑÌôò Î∞è Îç∞Ïù¥ÌÑ∞ Î°úÎìú Ìï®Ïàò
        function handlePageChange(page) {
          // Í∏∞Ï°¥ ÌéòÏù¥ÏßÄ Ï†ÑÌôò Î°úÏßÅ
          document
            .querySelectorAll(".page")
            .forEach((p) => (p.style.display = "none"));
          document
            .querySelectorAll(".nav-item")
            .forEach((n) => n.classList.remove("active"));
          document
            .querySelectorAll(".mobile-nav-item")
            .forEach((n) => n.classList.remove("active"));

          const targetPage = document.getElementById(`page-${page}`);
          if (targetPage) targetPage.style.display = "block";

          // ÏÇ¨Ïù¥ÎìúÎ∞î ÌôúÏÑ±Ìôî
          const sideNavItem = document.querySelector(
            `.nav-item[data-page="${page}"]`
          );
          if (sideNavItem) sideNavItem.classList.add("active");

          // Î™®Î∞îÏùº ÎÑ§ÎπÑÍ≤åÏù¥ÏÖò ÌôúÏÑ±Ìôî
          const mobileNavItem = document.querySelector(
            `.mobile-nav-item[data-page="${page}"]`
          );
          if (mobileNavItem) mobileNavItem.classList.add("active");

          // ÌéòÏù¥ÏßÄÎ≥Ñ Îç∞Ïù¥ÌÑ∞ Î°úÎìú
          if (page === "employees") {
            loadEmployees();
            loadHolidays();
            const now = new Date();
            if (document.getElementById("holidayYear")) {
              document.getElementById("holidayYear").value = now.getFullYear();
              document.getElementById("holidayMonth").value =
                now.getMonth() + 1;
            }
          } else if (page === "admin-attendance") {
            const now = new Date();
            if (document.getElementById("adminAttYear")) {
              document.getElementById("adminAttYear").value = now.getFullYear();
              document.getElementById("adminAttMonth").value =
                now.getMonth() + 1;
            }
            loadAdminAttendance();
          } else if (page === "margin" && marginData.length === 0) {
            loadMarginData();
          }
        }

        // ÏÇ¨Ïù¥ÎìúÎ∞î ÎÑ§ÎπÑÍ≤åÏù¥ÏÖò
        document.querySelectorAll(".nav-item").forEach((item) => {
          item.addEventListener("click", () => {
            handlePageChange(item.dataset.page);
          });
        });

        // Î™®Î∞îÏùº ÎÑ§ÎπÑÍ≤åÏù¥ÏÖò
        document.querySelectorAll(".mobile-nav-item").forEach((item) => {
          item.addEventListener("click", (e) => {
            e.preventDefault();
            handlePageChange(item.dataset.page);
          });
        });

        // Î°úÍ≥† ÌÅ¥Î¶≠
        document.getElementById("logoBtn").addEventListener("click", () => {
          handlePageChange("home");
        });
      };

      // ==================== Ï∂úÌá¥Í∑º ÏàòÏ†ï ÏöîÏ≤≠ Í¥ÄÎ¶¨ ====================

      let editRequests = [];
      let currentViewingRequest = null;

      async function loadEditRequests() {
        try {
          const response = await fetch(
            "/api/attendance-edit-requests?status=pending"
          );
          const result = await response.json();

          if (result.success) {
            editRequests = result.data || [];
            renderEditRequests();
          }
        } catch (error) {
          console.error("ÏàòÏ†ï ÏöîÏ≤≠ Î°úÎìú Ïã§Ìå®:", error);
        }
      }

      function renderEditRequests() {
        const section = document.getElementById("editRequestsSection");
        const list = document.getElementById("editRequestsList");
        const countEl = document.getElementById("editRequestCount");

        if (!section || !list) return;

        if (editRequests.length === 0) {
          section.style.display = "none";
          return;
        }

        section.style.display = "block";
        countEl.textContent = editRequests.length;

        let html = "";
        editRequests.forEach((req) => {
          const [y, m, d] = req.request_date.split("-");
          const empName = req.users?.name || "ÏßÅÏõê";

          html += `
            <div style="background: #1a1a1a; border: 1px solid #333; border-radius: 10px; padding: 15px; display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 10px;">
              <div style="flex: 1; min-width: 200px;">
                <div style="color: #ffd700; font-size: 14px; margin-bottom: 5px;">
                  üì® ${empName}ÎãòÏù¥ ${parseInt(m)}/${parseInt(
            d
          )}ÏùºÏùò Ï∂úÌá¥Í∑ºÏãúÍ∞Ñ ÏàòÏ†ï ÏöîÏ≤≠ÏùÑ Î≥¥ÎÉàÏäµÎãàÎã§!
                </div>
                <div style="color: #666; font-size: 12px;">
                  ${new Date(req.created_at).toLocaleString()}
                </div>
              </div>
              <button onclick="viewEditRequest(${
                req.id
              })" style="padding: 8px 16px; background: #00ff88; border: none; border-radius: 6px; color: #000; cursor: pointer; font-weight: 500; font-size: 13px;">
                Ïó¥Îûå
              </button>
            </div>
          `;
        });

        list.innerHTML = html;
      }

      function viewEditRequest(requestId) {
        const req = editRequests.find((r) => r.id === requestId);
        if (!req) return;

        currentViewingRequest = req;

        const [y, m, d] = req.request_date.split("-");
        const empName = req.users?.name || "ÏßÅÏõê";

        document.getElementById(
          "editRequestViewSubtitle"
        ).textContent = `${empName} - ${parseInt(m)}Ïõî ${parseInt(d)}Ïùº`;
        document.getElementById("viewOldClockIn").textContent = req.old_clock_in
          ? req.old_clock_in.substring(0, 5)
          : "--:--";
        document.getElementById("viewOldClockOut").textContent =
          req.old_clock_out ? req.old_clock_out.substring(0, 5) : "--:--";
        document.getElementById("viewNewClockIn").textContent = req.new_clock_in
          ? req.new_clock_in.substring(0, 5)
          : "--:--";
        document.getElementById("viewNewClockOut").textContent =
          req.new_clock_out ? req.new_clock_out.substring(0, 5) : "--:--";
        document.getElementById("viewReason").textContent = req.reason;

        document.getElementById("editRequestViewModal").style.display = "flex";
      }

      function closeEditRequestViewModal() {
        document.getElementById("editRequestViewModal").style.display = "none";
        currentViewingRequest = null;
      }

      async function approveEditRequest() {
        if (!currentViewingRequest) return;

        if (!confirm("Ïù¥ ÏàòÏ†ï ÏöîÏ≤≠ÏùÑ ÏäπÏù∏ÌïòÏãúÍ≤†ÏäµÎãàÍπå?")) return;

        const requestId = currentViewingRequest.id;
        showLoading();
        closeEditRequestViewModal();

        try {
          const response = await fetch(
            `/api/attendance-edit-request/${requestId}/approve`,
            {
              method: "POST",
            }
          );

          const result = await response.json();

          if (result.success) {
            showToast("success", "ÏàòÏ†ï ÏöîÏ≤≠Ïù¥ ÏäπÏù∏ÎêòÏóàÏäµÎãàÎã§");
            loadEditRequests();
          } else {
            showToast("error", result.error || "ÏäπÏù∏ Ïã§Ìå®");
          }
        } catch (error) {
          showToast("error", "ÏÑúÎ≤Ñ Ïò§Î•ò");
        }
        hideLoading();
      }

      function rejectEditRequest() {
        if (!currentViewingRequest) return;

        document.getElementById("editRequestViewModal").style.display = "none";
        document.getElementById("rejectReasonInput").value = "";
        document.getElementById("rejectReasonModal").style.display = "flex";
      }

      function closeRejectReasonModal() {
        document.getElementById("rejectReasonModal").style.display = "none";
      }

      async function submitRejectReason() {
        const reason = document
          .getElementById("rejectReasonInput")
          .value.trim();

        if (!reason) {
          showToast("error", "Í±∞Ï†à ÏÇ¨Ïú†Î•º ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî");
          return;
        }

        if (!currentViewingRequest) return;

        const requestId = currentViewingRequest.id;
        showLoading();
        closeRejectReasonModal();

        try {
          const response = await fetch(
            `/api/attendance-edit-request/${requestId}/reject`,
            {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify({ reject_reason: reason }),
            }
          );

          const result = await response.json();

          if (result.success) {
            showToast("success", "ÏàòÏ†ï ÏöîÏ≤≠Ïù¥ Í±∞Ï†àÎêòÏóàÏäµÎãàÎã§");
            loadEditRequests();
          } else {
            showToast("error", result.error || "Í±∞Ï†à Ïã§Ìå®");
          }
        } catch (error) {
          showToast("error", "ÏÑúÎ≤Ñ Ïò§Î•ò");
        }
        hideLoading();
        currentViewingRequest = null;
      }

      function showLoading() {
        const overlay = document.getElementById("loadingOverlay");
        if (overlay) overlay.classList.add("show");
      }

      function hideLoading() {
        const overlay = document.getElementById("loadingOverlay");
        if (overlay) overlay.classList.remove("show");
      }
    </script>
  </body>
</html>
