<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Excel Automation Tools</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        background: #0a0a0a;
        color: #ffffff;
        overflow: hidden;
      }

      .container {
        display: flex;
        height: 100vh;
      }

      /* ì‚¬ì´ë“œë°” */
      .sidebar {
        width: 250px;
        background: #1a1a1a;
        border-right: 2px solid #00ff88;
        padding: 20px;
        display: flex;
        flex-direction: column;
      }

      .logo {
        font-size: 24px;
        font-weight: bold;
        margin-bottom: 40px;
        color: #00ff88;
        text-shadow: 0 0 10px #00ff88;
      }

      .menu-item {
        padding: 15px 20px;
        margin-bottom: 10px;
        background: #2a2a2a;
        border: 1px solid #333;
        border-radius: 8px;
        cursor: pointer;
        transition: all 0.3s;
        color: #fff;
      }

      .menu-item:hover {
        background: #3a3a3a;
        border-color: #00ff88;
        box-shadow: 0 0 15px rgba(0, 255, 136, 0.3);
      }

      .menu-item.active {
        background: #00ff88;
        color: #0a0a0a;
        border-color: #00ff88;
        box-shadow: 0 0 20px rgba(0, 255, 136, 0.5);
      }

      /* ë©”ì¸ ì½˜í…ì¸  */
      .main-content {
        flex: 1;
        padding: 40px;
        overflow-y: auto;
      }

      .page {
        display: none;
      }

      .page.active {
        display: block;
        animation: fadeIn 0.3s;
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(10px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .page-title {
        font-size: 32px;
        margin-bottom: 30px;
        color: #00ff88;
        text-shadow: 0 0 10px rgba(0, 255, 136, 0.5);
      }

      /* ë“œë˜ê·¸ ì•¤ ë“œë¡­ ì˜ì—­ */
      .drop-zone {
        border: 3px dashed #00ff88;
        border-radius: 15px;
        padding: 60px;
        text-align: center;
        background: #1a1a1a;
        transition: all 0.3s;
        cursor: pointer;
      }

      .drop-zone:hover,
      .drop-zone.drag-over {
        background: #2a2a2a;
        box-shadow: 0 0 30px rgba(0, 255, 136, 0.3);
      }

      .drop-zone-icon {
        font-size: 64px;
        margin-bottom: 20px;
        color: #00ff88;
      }

      .drop-zone-text {
        font-size: 18px;
        color: #aaa;
      }

      /* ê²°ê³¼ ì¹´ë“œ */
      .result-card {
        background: #1a1a1a;
        border: 1px solid #00ff88;
        border-radius: 15px;
        padding: 30px;
        margin-top: 30px;
        box-shadow: 0 0 20px rgba(0, 255, 136, 0.2);
      }

      .stat {
        display: flex;
        justify-content: space-between;
        padding: 15px 0;
        border-bottom: 1px solid #333;
      }

      .stat:last-child {
        border-bottom: none;
      }

      .stat-label {
        color: #aaa;
      }

      .stat-value {
        color: #00ff88;
        font-weight: bold;
      }

      .download-btn {
        width: 100%;
        padding: 15px;
        background: #00ff88;
        color: #0a0a0a;
        border: none;
        border-radius: 8px;
        font-size: 16px;
        font-weight: bold;
        cursor: pointer;
        margin-top: 20px;
        transition: all 0.3s;
      }

      .download-btn:hover {
        box-shadow: 0 0 20px rgba(0, 255, 136, 0.5);
        transform: translateY(-2px);
      }

      /* ë¡œë”© */
      .loading {
        display: none;
        text-align: center;
        color: #00ff88;
        margin-top: 30px;
      }

      .loading.active {
        display: block;
      }

      .spinner {
        border: 4px solid #2a2a2a;
        border-top: 4px solid #00ff88;
        border-radius: 50%;
        width: 40px;
        height: 40px;
        animation: spin 1s linear infinite;
        margin: 0 auto 20px;
      }

      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }

      .hidden {
        display: none;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <!-- ì‚¬ì´ë“œë°” -->
      <div class="sidebar">
        <div class="logo">âš¡ íš¨ì§„ìœ í†µ</div>
        <div class="menu-item active" data-page="star-filter">
          ìŠ¤íƒ€ë°°ì†¡ í•„í„°
        </div>
        <div class="menu-item" data-page="feature2">ê¸°ëŠ¥ 2 (ì¤€ë¹„ì¤‘)</div>
        <div class="menu-item" data-page="feature3">ê¸°ëŠ¥ 3 (ì¤€ë¹„ì¤‘)</div>
      </div>

      <!-- ë©”ì¸ ì½˜í…ì¸  -->
      <div class="main-content">
        <!-- ìŠ¤íƒ€ë°°ì†¡ í•„í„° í˜ì´ì§€ -->
        <div class="page active" id="star-filter">
          <h1 class="page-title">íŒë§¤ì ìŠ¤íƒ€ë°°ì†¡ í•„í„°</h1>

          <div class="drop-zone" id="dropZone">
            <div class="drop-zone-icon">ğŸ“</div>
            <div class="drop-zone-text">
              ì—‘ì…€ íŒŒì¼ì„ ë“œë˜ê·¸í•˜ê±°ë‚˜ í´ë¦­í•˜ì—¬ ì„ íƒí•˜ì„¸ìš”<br />
              <small>(.xls, .xlsx íŒŒì¼ë§Œ ê°€ëŠ¥)</small>
            </div>
            <input
              type="file"
              id="fileInput"
              accept=".xls,.xlsx"
              class="hidden"
            />
          </div>

          <div class="loading" id="loading">
            <div class="spinner"></div>
            <p>ì²˜ë¦¬ ì¤‘...</p>
          </div>

          <div class="result-card hidden" id="resultCard">
            <div class="stat">
              <span class="stat-label">ì›ë³¸ í–‰ ìˆ˜</span>
              <span class="stat-value" id="originalCount">-</span>
            </div>
            <div class="stat">
              <span class="stat-label">ì‚­ì œëœ í–‰ ìˆ˜</span>
              <span class="stat-value" id="deletedCount">-</span>
            </div>
            <div class="stat">
              <span class="stat-label">ìµœì¢… í–‰ ìˆ˜</span>
              <span class="stat-value" id="finalCount">-</span>
            </div>
            <button class="download-btn" id="downloadBtn">ë‹¤ìš´ë¡œë“œ</button>
          </div>
        </div>

        <!-- ê¸°ëŠ¥ 2 í˜ì´ì§€ -->
        <div class="page" id="feature2">
          <h1 class="page-title">ê¸°ëŠ¥ 2</h1>
          <p style="color: #aaa">ì¤€ë¹„ì¤‘ì…ë‹ˆë‹¤...</p>
        </div>

        <!-- ê¸°ëŠ¥ 3 í˜ì´ì§€ -->
        <div class="page" id="feature3">
          <h1 class="page-title">ê¸°ëŠ¥ 3</h1>
          <p style="color: #aaa">ì¤€ë¹„ì¤‘ì…ë‹ˆë‹¤...</p>
        </div>
      </div>
    </div>

    <script>
      let processedFile = null;

      // í˜ì´ì§€ ì „í™˜
      document.querySelectorAll(".menu-item").forEach((item) => {
        item.addEventListener("click", function () {
          // ë©”ë‰´ active ìƒíƒœ ë³€ê²½
          document
            .querySelectorAll(".menu-item")
            .forEach((m) => m.classList.remove("active"));
          this.classList.add("active");

          // í˜ì´ì§€ ì „í™˜
          const pageId = this.dataset.page;
          document
            .querySelectorAll(".page")
            .forEach((p) => p.classList.remove("active"));
          document.getElementById(pageId).classList.add("active");
        });
      });

      // ë“œë˜ê·¸ ì•¤ ë“œë¡­
      const dropZone = document.getElementById("dropZone");
      const fileInput = document.getElementById("fileInput");

      dropZone.addEventListener("click", () => fileInput.click());

      dropZone.addEventListener("dragover", (e) => {
        e.preventDefault();
        dropZone.classList.add("drag-over");
      });

      dropZone.addEventListener("dragleave", () => {
        dropZone.classList.remove("drag-over");
      });

      dropZone.addEventListener("drop", (e) => {
        e.preventDefault();
        dropZone.classList.remove("drag-over");
        const files = e.dataTransfer.files;
        if (files.length > 0) {
          handleFile(files[0]);
        }
      });

      fileInput.addEventListener("change", (e) => {
        if (e.target.files.length > 0) {
          handleFile(e.target.files[0]);
        }
      });

      // íŒŒì¼ ì²˜ë¦¬
      async function handleFile(file) {
        const loading = document.getElementById("loading");
        const resultCard = document.getElementById("resultCard");

        loading.classList.add("active");
        resultCard.classList.add("hidden");

        const formData = new FormData();
        formData.append("file", file);

        try {
          const response = await fetch("/upload", {
            method: "POST",
            body: formData,
          });

          if (!response.ok) {
            const error = await response.json();
            throw new Error(error.error || "ì²˜ë¦¬ ì‹¤íŒ¨");
          }

          const originalCount = response.headers.get("X-Original-Count");
          const deletedCount = response.headers.get("X-Deleted-Count");
          const finalCount = originalCount - deletedCount;

          document.getElementById("originalCount").textContent = originalCount;
          document.getElementById("deletedCount").textContent = deletedCount;
          document.getElementById("finalCount").textContent = finalCount;

          processedFile = await response.blob();
          const filename =
            response.headers
              .get("content-disposition")
              ?.match(/filename="?(.+)"?/)?.[1] || "filtered.xlsx";
          processedFile.filename = filename;

          resultCard.classList.remove("hidden");
        } catch (error) {
          alert("ì˜¤ë¥˜: " + error.message);
        } finally {
          loading.classList.remove("active");
        }
      }

      // ë‹¤ìš´ë¡œë“œ
      document.getElementById("downloadBtn").addEventListener("click", () => {
        if (processedFile) {
          const url = URL.createObjectURL(processedFile);
          const a = document.createElement("a");
          a.href = url;
          a.download = processedFile.filename;
          a.click();
          URL.revokeObjectURL(url);
        }
      });
    </script>
  </body>
</html>
